2005-04-28  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm (X11_options): Accept string variables for terminal
	options 'font <foo>' and 'title <bar>'.

	* term/post.trm (PS_options) term/emf.trm (EMF_options): 
	Accept string variable for font name.

2005-04-28  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* config/makefile.wc: Update for more Watcom-like usage of tools.

	* config/config.wc: New file.  Promised long ago, when I added
	makefile.wc, finally got round to doing it.
	
	* config/config.oww, config/makefile.oww: Rewrite for more
	features and more Watcom-like usage of tools.

	* src/readline.c [__WATCOMC__]: Add #include <conio.h> for getch()
	function.

2005-04-27  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c (set_label): If the first option after 'set label' is an
	expression, handle it appropriately whether it is a numerical expression
	that provides the label id tag or a string expression that provides the
	label itself.

2005-04-27  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/command.c (call_kill_pending_Pause_dialog): Fix accidental
	removal of this function caused by yesterday's change.

2005-04-26  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/win/wgraph.c (drawgraph): Initialize local variable to avoid
	a -Wuninitialized.

	* src/history.c (write_history_n): Only define local is_pipe if
	PIPES enabled.  Avoids a -Wunused.

	* src/command.c (winsystem): Define this function only if
	USE_OWN_WINSYSTEM_FUNCTION is set.  Removes a -Wunused.

2005-04-24  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Fix a typo in the example using enhanced text font sizes.

2005-04-24  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/pm3d.c (set_plot_with_palette): Show colorbox for 'splot ... with
	... palette'.

2005-04-23  Ethan Merritt  <merritt@u.washington.edu>

	Bug fix: Do not apply axis mapping (e.g. log scale) twice to the
	label coordinates in plot style 'with labels'.

	* src/gadgets.h: Define a new "layer" LAYER_PLOTLABELS, which 
	allows the label-processing code to distinguish labels whose coords
	have already been axis-mapped from those where they have not.

	* src/graphics.c (place_labels do_plot) src/plot2d.c (eval_plots) 
	src/graph3d.c (place_labels3d do_3dplot) src/plot3d.c (eval_3dplots):
	Mark the labels making up a 'with labels' plot as belonging to 
	LAYER_PLOTLABELS rather than to front or back layers.

	* src/gplt_x11.c (exec_cmd): When setting a new font, set it for
	both the normal and pm3d graphics contexts.

2005-04-22  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* config/makefile.oww, config/config.oww, src/makefile.awc: New
	build files for Win32 build using OpenWatcom compiler.

	* src/win/winmain.c (mktemp) [__WATCOMC__]: Added name override to
	_mktemp.
	(_argv, _argc) [__WATCOMC__]: Added name overrides to __argc and
	__argv.

	* src/win/wgnuplib.h: Added #include <windows.h>

	* src/win/pgnuplot.c (_setmode) [__WATCOMC__]: Added name override
	to setmode.
	
	* src/term.c [__WATCOMC__]: Added #include <io.h>.

	* src/syscfg.h [__WATCOMC__]: Added #include <dos.h>.

	* src/stdfn.h [WIN32]: Added #include <windows.h> for necessary
	type declarations like DWORD.

	* src/specfun.c (BIGENDIAN): Removed unused definition conflicting
	with system headers.

	* src/mouse.c [_Windows]: Added #include "win/winmain.h" for
	kill_pending_Pause_dialog() prototype.

	* src/fit.c (ERROR): Renamed to GP_ERROR to avoid conflict with
	some system headers.
	(FIXED): Renamed to GP_FIXED to avoid conflicts with system
	headers.

	* src/command.c [__WATCOMC__]: Don't #include <dir.h>.

	* src/bitmap.c (IN) Macro conflicts with names used by some system
	headers.  Removed.
	(b_setpixel): Replace usage of macro IN by simplified expansion.

	* docs/xref.c (xmalloc): Fixed missing return from non-void
	function.

2005-04-21  Ethan Merritt  <merritt@u.washington.edu>

	* src/command.c (pause_command) src/command.h docs/gnuplot.doc:
	Modify syntax of pause mouse command:
	    pause mouse {<end_condition>}{,<end_condition>}... {"prompt"}
	where <end_condition> is one of
	    keystroke, button1, button2, button3, any

	* src/mouse.c (event_keypress event_buttonpress event_bottonrelease
	event_reset) src/term (term_reset) src/win/wpause.c term/x11.trm:
	Test individually for specific end conditions for `pause mouse`.

2005-04-18  Ethan Merritt  <merritt@u.washington.edu>

	* src/save.c (save_linetype) src/save.h src/show.c:    Code cleanup.
	Provide a single routine to handle all the places that dump information
	from a structure of type lp_style_type. This cleans up 9 call sites in
	save.c and 9 more in show.c, many of which were not handling the recent
	extensions to line types in general.  The grid linetypes were not being
	saved at all.

	* src/set.c (set_key): Fix parsing bug that caused next item after
	'set key title "Foo"' to be ignored.

	* src/graphics.c (boundary): Fix for bug #1184989. Explicitly test for
	absence of any plot titles when sizing the key (avoid divide-by-zero).

2005-04-18  Petr Mikulik  <mikulik@physics.muni.cz>

	* term/fig.trm (FIG_set_color): Support for "textcolor lt".

2005-04-16  Juergen Wieferink <wieferink@freenet.de>

	* term/pslatex.trm: Clean up macro definitions written to
	output file of 'set term epslatex'. 
	Fixes bug #1162038 "Wrong textcolor in epslatex terminal".

2005-04-14  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c (set_border): Fix bug in new parsing loop.

2005-04-14  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc src/gadgets.c src/gadgets.h
	src/graphics.c (do_plot) src/save.c (save_set_all) 
	src/set.c (set_border) src/show.c (show_border):
	Make parsing of 'set border' options independent of their order.
	New option 'set border {front|back}'.

2005-04-11  Ethan Merritt  <merritt@u.washington.edu>

	* term/post.trm: Fix for bug #1180853, arrowheads drawn in wrong
	color if the arrow body has a specific line style or color.

2005-04-10  Ethan Merritt  <merritt@u.washington.edu>

	* demo/histograms.dem:  Correct behaviour of the demo depended
	on a bug in the xrange code.  Now that the bug is fixed (26-Mar-05)
	the demo needs to be fixed also (don't set xrange to [0:*]).

2005-04-08  Ethan Merritt  <merritt@u.washington.edu>

	* Makefile.am configure.in:  Continued attempts to make configure
	ignore lisp files altogether when --without-lisp-files is chosen.
	In this case skip ./lisp subdirectory during 'make' recursion.

2005-04-08  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gnuplot.doc: Improved 'help cbrange'.

2005-04-06  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/pm3d.c (set_plot_with_palette): Do not set the flag for displaying
	colorbox for 'splot ... with rgbimage'.

2005-04-06  Ethan Merritt  <merritt@u.washington.edu>

	* term/README:  Show call order of enhanced text mode entry points
	and mention that 'set termoption' calls into term->options().

2005-04-03  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c: Allow 'set termoption delay <n>' to change the interframe
	gap of a gif animation in progress.

	* term/gd.trm (PNG_options):
	Add gif animation option 'loop <repeatcount>'. Protect current animation
	state from being reset by a 'set termoption' command, but alow the frame
	delay to be changed. List animation options in terminal options string.

2005-04-03  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* docs/gnuplot.doc: Remove blanks from whitespace-only lines.

2005-04-01  Juergen Wieferink <wieferink@freenet.de>

	* docs/doc2tex.c: Handle levels 5 and 6 of documentation text as
	paragraph and subparagraph, respectively.

2005-04-01  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc: Add help keyword for 'newhistogram'.

	* configure.in: If the user configures --without-lisp-files then
	do not try to run configure in the lisp subdirectory.

2005-03-30  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/gplt_x11.c (process_event) [!USE_MOUSE]: don't refer to
	objects and functions not defined in this case.

	* src/plot3d.c (eval_3dplots) [!GP_STRING_VARS]: Don't call
	isstringvar() if feature disabled.

	* src/plot2d.c (eval_plots) [!GP_STRING_VARS]: Likewise.

	* src/show.c (show_command): Fix display of 'zeroaxis' settings
	reported by error message.

	* src/set.c (set_command): Likewise.

	* src/unset.c (unset_command): Likewise.

2005-03-29  Ethan Merritt  <merritt@u.washington.edu>

	* demo/candlesticks.dem: Add demo of whiskerbars option.

2005-03-29  Petr Mikulik  <mikulik@physics.muni.cz>

	* NEWS docs/gnuplot.doc src/plot3d.c src/pm3d.c src/pm3d.h src/save.c
	src/set.c src/show.c src/unset.c: Let pm3d drawing be always available
	without prior "set pm3d": now you can "splot x*y with pm3d" without
	prior "set pm3d". The "explicit" be the default pm3d value after reset.
	For compatibility (historical) reasons (color filled pm3d plot
	combined with mesh line plot): commands "set pm3d;" and "set pm3d at X
	other_opts;" switch pm3d to "implicit". No change for "set pm3d map".

2005-03-29  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/pm3d.c (set_plot_with_palette): Add a missing #ifdef
	WITH_IMAGE conditional.

2005-03-27  Ethan Merritt  <merritt@u.washington.edu>

	* NEWS configure.in term/gd.trm: Allow storage of a sequence of plots
	into a single animated gif file.
	    set term gif animate {delay <time>} {nooptimize}
	Requires libgd version 2.0.29 or better (2.0.33 is recommended).

	* src/plot2d.c (histogram_range_fiddling): Make it more obvious in the
	code that histograms always use FIRST_X_AXIS.

2005-03-26  Ethan Merritt  <merritt@u.washington.edu>

	SourceForge patch #1090199 "Extend hotkeys to all open plot windows"

	Implement new option "bind all <key> <command>" that extends
	hotkeys to inactive plot windows in addition to the active window.
	The code is general, although currently only the x11 terminal
	tracks the ID of multiple windows in order to report who is who.

	* src/command.c (bind_command): New keyword "bind {all$windows} ..."

	* src/gpexecute.c (gp_exec_event) src/gpexecute.h:
	New parameter holds ID of window from which this event was triggered.
	
	* src/gplt_x11.c (process_event): Pass ID of originating window to
	gp_exec_event() along with the x,y coordinates and keystroke.
	Distinguish between active and inactive window by using event code
	GE_keypress or GE_keypress_old. You get the window ID in either case.

	* src/mousecmn.h: Add new field int winid to struct gp_event_t.

	* src/mouse.c src/mouse.h:
	Add new TBOOLEAN allwindows to the bind_t structure.
	New routine bind_all() sets this flag from "bind all <foo> <baz>".
	Teach event_keypress() to distinguish between keystrokes from active
	or inactive windows, and to load originating window ID into udv
	MOUSE_KEY_WINDOW so that it is visible to user-defined commands.

	* src/os2/gclient.c src/win/wgraph.c:
	Add extra parameter for window ID in all calls to gp_exec_event().

	* docs/gnuplot.doc: Document new command option "bind all <key>
	<command>".

	* src/mouse.c (event_buttonpress) term/x11.trm (X11_waitforinput):
	Do not terminate "pause mouse key" on mouse button clicks. This allows
	zoom, select, and other mouse-click operations during the pause.

2005-03-26  Ethan Merritt  <merritt@u.washington.edu>

	SourceForge patch #1120626 (contributed by Frank Maas).
	
	* src/plot2d.c (histogram_range_fiddling): When processing
	histograms, allow auto-scaling of either end of the X-range
	individually.

2005-03-25  Ethan Merritt  <merritt@u.washington.edu>

	* config/makefile.amg config/term_pc.h docs/Makefile.in
	sec/makefile.all: Remove dependencies involving table.trm.

	* term/table.trm: Remove this file.

2005-03-25  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/plot2d.c (eval_plots): Add a missing #ifdef EAM_DATASTRINGS
	protection block.

2005-03-25  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/plot2d.c (eval_plots) src/plot3d.c (eval_3dplots): Don't increment
	the default line/point properties for line/point plots if this_plot is
	an (rgb)image (the same is already happening for pm3d plots).
	Otherwise, "splot 'a.dat' with image,x*y with line" and "... x*y w line,
	'a.dat' with image" draw surface x*y in different colours.

2005-03-24  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc src/set.c (set_table) src/unset.c (unset_table) 
	src/tables.h src/tables.c:
	New commands
	    set table {"outfile"}
	    unset table
	These replace the old 'set term table', which never worked in general.

	* src/gadgets.c src/gadgets.h:  TBOOLEAM table_mode and output file
	pointer table_outfile shared by plot2d and plot3d in table mode.

	* src/plot2d.c (print_table) src/plot3d.c (print_3dtable):
	If table_mode is set we send tabular output to table_outfile, if it was
	specified, otherwise send it to gpoutfile.

	* src/set.c (set_terminal): Allow 'set term table' as a special case
	backwards compatibility option.  It doesn't work all that well, but then
	again the original didn't work either.

	* demo/all.dem demo/vector.dem: Rework vector.dem to use the new
	commands.  This makes it safe to include as part of all.dem because
	unlike the old 'set term table' it doesn't trash the current state of
	the output device.

	* src/term.c src/term.h: Remove table.trm from the list of terminals.

2005-03-24  Ethan Merritt  <merritt@u.washington.edu>

	* term/post.trm: Initialize the data structure pointer ps_params to
	point to the normal postscript mode values; without this, setting
	environmental variable GNUTERM to any of the PostScript terminal modes
	will cause a segfault on entry.

2005-03-23  Aapo Lankinen <aapo.lankinen@gmail.com>

	* src/contour.c (contour): Bugfix: logscale on CB was being applied
	twice when calculating contour colors.

2005-03-23  Petr Mikulik  <mikulik@physics.muni.cz>

	* NEWS src/plot2d.c src/plot3d.c docs/gnuplot.doc: SF patch # 1098256
	"Ignore title string after notitle":
	Let the string in '{s}plot ... notitle "string"' be silently ignored.

2005-03-21  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/plot3d.c (eval_3dplots): Better fix for 'set pm3d at X;
	splot f(x,y), 'data_file' with pm3d at Y' for data_file with
	multiple surfaces.

	* src/graph3d.c (do_3dplot): Remove fix from 2005-03-17. 
	Fix 'set pm3d at X; splot...with pm3d at Y'
	for data files with multiple surfaces.

2005-03-18  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* docs/gnuplot.doc (set title): Add missing keyword "font".

2005-03-17  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/graph3d.c (do_3dplot): Fix 'set pm3d at X; splot...with pm3d at Y'
	for data files with multiple surfaces.

2005-03-16  Ethan Merritt  <merritt@u.washington.edu>

	* src/datafile.c (df_readline): Allow for embedded whitespace in the
	output of a string-valued expression inside a "using" spec.

	* src/graph3d.c (plot3d_points_pm3d plot3d_points): Remove routine
	plot3d_points_pm3d, and handle pm3d-colored points in plot3d_points
	instead. This removes any special drawing order for the points.

2005-03-16  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/axis.h (AXIS_ACTUAL_MAX, AXIS_ACTUAL_MIN): New macros to
	access range endpoints correctly, even if 'set view map' has mixed
	up the internal status.

	* src/util3d.c (IN_AXIS_RANGE): New macro, equivalent to calling
	inrange() with the two endpoints of any given axis' range.  Makes
	code a bit more readable.
	(edge3d_intersect): New local macros INTERSECT_PLANE,
	INTERSECT_DIAG to centralize lots of very similar code blocks.
	Implement fix for clipping of -VERYLARGE points in the presence of
	'set view map' reversed ranges, by using new axis.h macros.
	(two_edge3d_intersect): Use new macro IN_AXIS_RANGE, reindent, for
	readability.
	
2005-03-15  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/pm3d.c (set_plot_with_palette): Fix displaying colorbox also for
	'splot ... with image'.

2005-03-14  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/pm3d.c (set_plot_with_palette): Fix displaying colorbox for 'plot
	... with image'.

2005-03-12  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot2d.c (eval_plots): Fix bug in initialization order that
	prevented "set style data labels" from working in 2D plots.

2005-03-09  Ethan Merritt  <merritt@u.washington.edu>

	* term/emf.trm term/gd.trm term/pdf.trm term/pm.trm term/post.trm
	term/svg.trm term/x11.trm src/gplt_x11.c src/gplt_x11.h:
	Modify term->set_color() to handle colorspec type LC_LT.
	This has the effect of changing the current line color to that of
	default linetype <lc> without changing any other line properties.

	* misc.c (lp_parse) save.c (save_set_all) show.c (show_linestyle)
	docs/gnuplot.doc:
	Allow line color {linecolor|lc} to be specified separately from the
	linetype. For example, this command will give a dashed black line:
	    set style line 1 lt 2 lc -1
	and the following will give a dashed gold line:
	    plot sin(x) with lines lt 2 lc rgb "gold"

	* demo/dashcolor.dem: Demo of choosing both linetype (dot/dash pattern)
	and linecolor separately.

	* src/misc.c (arrow_parse): Bugfix: Keep current linetype as the default
	when parsing possible additional line style options.

2005-03-06  Ethan Merritt  <merritt@u.washington.edu>

	* src/datafile.c (df_readline) src/misc.c (parse_colorspec): 
	Clean up code to remove the remaining 2 compiler warnings in current cvs.

2005-03-05  Harald Harders  <h.harders@tu-bs.de>

	* term/post.trm (PS_options): Patch #1121971. Avoid external 
	processing of escaped characters in the epslatex header string.

2005-03-05  Ethan Merritt  <merritt@u.washington.edu>

	* src/datafile.c (df_readline): Plug a memory leak caused by evaluating
	a string-valued expression inside a "using" specification.

	* configure.in /config/config.amg /config/config.cyg /config/config.mgw
	/config/config.os2 /src/eval.c /src/eval.h /src/internal.c
	/src/internal.h /src/parse.c /src/standard.c /src/standard.h:

	Remove configuration option --disable-defined-var.
	Remove the #ifdef GP_ISVAR ... #endif bracketing the corresponding code.

	* term/cgm.trm (CGM_linecolor): Force all line and point color requests
	to black if the terminal is in monochrome mode. Bug fix courtesy of 
	N Matsuda (Tokyo Denki University).

2005-03-04  Ethan Merritt  <merritt@u.washington.edu>

	* src/datafile.c: Introduce a defined constant MAX_TOKEN_LENGTH
	rather than trusting multiple call sites to declare consistently
	sized character arrays.

	* src/eval.c src/datafile.h src/datafile.c docs/gnuplot.doc:
	New internal function f_stringcolumn() usable only inside a "using"
	specification; pushes the content of a data column onto the evaluation
	stack as a string variable.
	Syntax:
	    plot 'foo' using (stringcolumn(1) eq "baz" ? column(2) : column(3))

	* src/datafile.c (df_readline df_3dmatrix df_readbinary):
	Set a flag to indicate that we are in the process of evaluating a
	"using" specification.

	* src/datafile.c (f_column f_timecolumn f_stringcolumn):
	Report an error if any of the <xxx>column() functions  are called
	outside the context of a "using" specification.

	* configure.in: Remove the "EXPERIMENTAL" warning from the histogram
	and datastrings options; they've had 2 years of testing.

2005-03-02  Ethan Merritt  <merritt@u.washington.edu>

	* src/unset.c (unset_historysize): Rearrange #ifdefs for GNUPLOT_HISTORY
	to prevent compiler warnings about unused function definitions.

	* src/term.h term/post.h term/post.trm: Introduce a statement 
	'#define PSLATEX_DRIVER' into post.h that controls whether or not the
	pslatex/epslatex terminal code is built.  Add #ifdef PSLATEX_DRIVER
	in appropriate places.  Without this it was impossible to build gnuplot
	with post.trm but not pslatex.trm.

	* src/term.h: Remove aed.trm and tek.trm from SHORT_TERMLIST set of
	terminals, but add estimate.trm if it is enabled.

	* configure.in src/graphics.c src/plot2d.c src/save.c src/set.c
	src/show.c src/unset.c src/plot2d.h:

	Remove configuration option --disable-relative-boxwidth. 
	Remove the #ifdef USE_ULIG_RELATIVE_BOXWIDTH ... #endif brackets around
	code that implements it.

	* config/config.amg config/config.cyg config/config.mgw config/config.nt
	config/config.os2 configure.in src/bitmap.c src/datafile.c src/gadgets.c
	src/gplt_x11.c src/gp_types.h src/graphics.c src/misc.c src/plot2d.c
	src/save.c src/show.c src/term_api.h src/term.c src/unset.c
	src/win/wgraph.c term/aquaterm.trm term/cgm.trm term/fig.trm term/gd.trm
	term/mif.trm term/pdf.trm term/post.trm term/svg.trm term/win.trm
	term/x11.trm:

	Remove configuration option --disable-filledboxes
	Remove the #ifdef USE_ULIG_FILLEDBOXES ... #endif brackets around code
	that implements it.

2005-02-28  Ethan Merritt  <merritt@u.washington.edu>

	* term/pslatex.trm: EPSLATEX_set_color must be protected by #ifdef PM3D.

2005-02-26  Ethan Merritt  <merritt@u.washington.edu>

	* src/pm3d.c (set_plot_with_palette): Don't trigger display of the
	colorbox in 2D plots just because an explicit line color was set.

	* misc.c (parse_fillstyle): accept full keyword "fillstyle" in addition
	to short form "fs".

2005-02-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c(plot_c_bars) src/plot2d.c(eval_plots) docs/gnuplot.doc:
	New keyword  '... with candlesticks {whiskerbars}' that draws horizontal
	crossbars at the top and bottom of the whiskers. This is typical for
	box-and-whisker plots.  The new keyword is in lieu of adding a
	separate "boxplots" plot style (patch #624000).

	* src/gplt_x11.c (pr_fastrotate) term/x11.trm (documentation):
	The fully general implementation of text rotation added in version 4.0
	is *much* slower than it used to be. This patch adds a new X resource
	gnuplot*fastrotate: {on|off} that reverts to the faster but imperfect
	rotation method.  The default is "on", which favors fast rendering at
	the cost of possibly corrupting colors of nearby plot elements.

2005-02-22  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Fix botched optimization in previous patch.

2005-02-21  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Implement solid fill rectangles and polygons as a
	true solid color, with variable fading toward background color, rather
	than approximating by a set of 3 half-tone patterns.

	* docs/gnuplot.doc: Explain that for some terminals the size of a "dot"
	can be changed using linewidth.

2005-02-18  Ethan Merritt  <merritt@u.washington.edu>

	* term/pdf.trm:  Allow "lw" as an abbreviation for "linewidth"
	* term/post.trm: Make dash styles 6 and 7 a bit more distinctive
	* term/emf.trm:  Add option 'set term emf {linewidth <factor>}'
	* term/gd.trm:   Solid fill with density < 1 was not working with 
			 rgb colors.  Trivial fix.
	* term/gd.trm:   Add option 'set term ... {linewidth <factor>}';
			 increase maximum linewidth from 6 to 12

	* src/graphics.c (boundary): When estimating the length and height
	of xlabel, increase the number of lines by one if we're in enhanced text
	mode and there seems to be a subscript. This test can be fooled if the
	label has disabled enhanced text processing.

2005-02-18  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/command.c src/tables.c src/set.c src/unset.c docs/gnuplot.doc: Let
	command '{un}set historysize' be always available, but report a
	descriptive error if gnuplot has not been configured with GNU readline.

2005-02-17  Ethan Merritt  <merritt@u.washington.edu>

	* term/pdf.trm: Add terminal options for monochrome and for dashed
	lines:
	    set term pdf {mono|color|colour} {solid|dashed {dl dashlength}}

	The defaults remain the same as before (color solid). The monochrome
	option only affects linetypes; you can still use color explicitly
	in filled areas or by using rgb specifications for line styles.

	* configure.in: Check for dashed line support in pdflib.

2005-02-16  Harald Harders  <h.harders@tu-bs.de>

	* term/post.trm: Patch #1122014 "Improve dashed linetypes in Postscript
	terminals".
	
2005-02-16  Ethan Merritt  <merritt@u.washington.edu>

	* term/pdf.trm: Correct the driver docs to say font limitations
	and font installation instructions must be sought in the pdflib
	documention.

2005-02-16  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/variable.c (loadpath_handler, fontpath_handler):
	Re-initialize limit to NULL, too, as p reaches it.

2005-02-15  Ethan Merritt  <merritt@u.washington.edu>

	* src/save.c src/save.h: New routine save_fillstyle consolidates
	redundant code to convert a fill_style_type into a text description.

	* src/save.c src/save.h: New routine save_pm3dcolor consolidates
	redundant code to convert a colorspec struct into a text description.

	* src/save.c (save_set_all save_textcolor) src/show.c (show_linestyle):
	Call shared routines rather than duplicate code in-line.

2005-02-14  Ethan Merritt  <merritt@u.washington.edu>

	* term/pdf.trm (PDF_options PDF_init PDF_dot): Add terminal option
	{rounded|butt} exactly parallel to post.trm. The default is butt
	ends and mitred line joins. "rounded" switches to rounded ends and
	rounded joins.

2005-02-14  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/term.c: Added #include "getcolor.h".

	* term/aquaterm.trm term/pdf.trm term/post.trm term/svg.trm: Removed
	#include "getcolor.h".

	* term/x11.trm: Removed #include "getcolor.h", #ifdef WITH_IMAGE_BUG
	#include "graphics.h".

	* term/vgagl.trm: Removed #include "driver.h", "pm3d.h", "mousecmn.h".

2005-02-14  Harald Harders  <h.harders@tu-bs.de>

	* term/pslatex.trm: SourceForge patch #1121972 "Improve input encoding
	in epslatex terminal". Added the koi8-u encoding to epslatex. Added
	\inputencoding{...} to the output file. This enables the user to use
	different input encodings in the surrounding LaTeX file and in the plot.
	Added a user-friendly error message if the package graphicx.sty or
	graphics.sty is not loaded.

2005-02-13  Harald Harders  <h.harders@tu-bs.de>

	* term/post.trm term/pslatex.trm: Clean up code in accordance with
	compiler warnings.

2005-02-13  Shigeharu Takeno  <shige@iee.niit.ac.jp>

	* configure.in: New configuration option --enable-x11-mbfonts
	(enabled by default).  Interpretation of character encodings
	is determined at run time by the LC_CTYPE locale setting.
	
	* src/gplt_x11.c: All calls to x11 font handling routines are
	conditionally substituted by the equivalent calls to multi-byte
	routines if --enable-x11-mbfonts is configured, and a multi-byte
	font has in fact been selected.

	* NEWS term/x11.trm: Add documentation that describes the specification
	of multi-byte fonts:
	    set term x11 font "mbfont:<primary font>;<secondary font>"
	    set label "foo" font "mbfont:<primary font>;<secondary font>"

2005-02-10  Ethan Merritt  <merritt@u.washington.edu>

	* src/graph3d.c (plot3d_lines_pm3d key_sample_line_pm3d): 
	If the graph specifies a solid rgb color, fall back to equivalent
	single-color routine.

2005-02-11  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/pm3d.h src/pm3d.c: New global routine is_plot_with_colorbox().
	New local variable plot_wants_colorbox. Color box is wanted for all draw
	elements using palette except those with TC_RGB.

	* src/graphics.c src/graph3d.c: No colorbox for 2D and 3D plots with
	elements using "rgbcolor".

2005-02-10  Ethan Merritt  <merritt@u.washington.edu>

	* src/misc.c (lp_parse): Accept full keyword "rgbcolor" for the line
	attribute.

2005-02-09  Harald Harders  <h.harders@tu-bs.de>

	SourceForge patch #1040192 "Merge post, epslatex, pslatex, pstex
	terminals".

	* NEWS demo/Makefile.am.in docs/Makefile.in docs/gnuplot.doc
	src/graph3d.c src/graphics.c src/makefile.all src/term.c src/term.h
	term/post.h term/post.trm: Miscellaneous changes.

	* demo/epslatex.dem demo/gnuplot.cfg: New demo and its LaTeX
	configuration file for usage with gnuplot-generated LaTeX files
	(epslatex terminal with standalone option).

	* term/pslatex.trm: Now includes code for all of the following
	terminals:
	  pslatex:  LaTeX with embedded postscript
	  pstex:    plain TeX with embedded postscript
	  epslatex: LaTeX using \includegraphics, postscript part in an external
	  	    file

	* term/epslatex.trm: Removed.

	* share/: New directory.

	* share/LaTeX/Makefile share/LaTeX/README share/LaTeX/gnuplot.cfg:
	New directory LaTeX/. New files for supporting the epslatex terminal.

2005-02-05  Ethan Merritt  <merritt@u.washington.edu>

	* src/color.h src/save.c (save_textcolor) src/gadgets (apply_pm3dcolor)
	src/misc.c (lp_use_properties) docs/gnuplot.doc:
	New internal flag TC_LINESTYLE allows text to take its color from a
	line style. For example:    set label "foo" textcolor linestyle 2

2005-02-04  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (do_key_sample plot_boxes)
	src/term.c (term_apply_lp_properties):
	Apply linetype properties (color *AND* dot/dash/solid) before applying
	pm3d color, if any.

2005-02-02  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot3d.c (get_3ddata): Ignore blank lines in data file input to
	"splot with vectors".

	* src/set.c (set_xyzlabel): Allow set label textcolor rgb <foo>.

	* src/gplt_x11.c (display): Always initialize gc_pm3d, in case we need
	it to handle individual rgb colors even in the absence of a palette.

	* src/save.c (save_textcolor) src/save.h 
	src/show.c (show_label show_xyzlabel): Export save_textcolor() so
	that various "show ...label" routines can use it also. Also fixes
	compile error if configured --disable-pm3d.

2005-02-01  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (plot_boxes): Plot with boxerrorbars and three columns
	of input data hit a rare code path that set the boxwidth wrong in some
	cases. Fixes bug #1101409.

2005-02-01  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/time.c (xstrftime): Shift reply range of %I and %l time
	formats from [0:11] to [1:12].

	* docs/gnuplot.doc (time/date specifiers): Fix descriptions of
	hour format specifiers (explain 0-filled vs. non-filled default,
	give correct output ranges).

2005-02-01  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/set.c (set_separator): Replace literal TAB character in
	source by a \t.

	* src/command.c (input_line, input_line_len): Renamed to
	gp_input_line and gp_input_line_len respectively, to avoid a
	conflict of input_line with a like name non-standard library
	function on QNX.

	* src/command.h: Renamed declarations of these, too.

	* all over the place: Renamed usages of these variables.  Some
	CodeStyle cleanups, while at it.

2005-01-31  Ethan Merritt  <merritt@u.washington.edu>

	 * util.c (getusername): Don't try to free a string pointer that may
	 have been returned by getenv.  Fixes bug #1111804.

2005-01-27  Petr Mikulik  <mikulik@physics.muni.cz>

	* config/config.mgw: Mingw 2.x does not HAVE_SYS_PARAM_H.

	* src/win/wgnuplib.h: Mingw 2.x needs to #define _fstr* functions.

2005-01-26  Petr Mikulik  <mikulik@physics.muni.cz>

	* demo/pm3d.dem: Remove deprecated references to "set pm3d solid" and
	"set pm3d transparent".

2005-01-26  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/win/pgnuplot.c (PostString): Fix transmission of 8-bit
	characters to function taking ints by cast to unsigned char.

2005-01-25  Ethan Merritt  <merritt@u.washington.edu>

	* term/ai.trm (AI_reset) term/corel.trm (COREL_reset) term/epslatex.trm
	(EPSL_init EPSL_text): Remove extraneous % characters in strings output
	by fputs().

2005-01-24  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/command.c (save_command): Remove extraneous c_token++.

2005-01-20  Dietmar Warning  <warning@danalyse.de>

	* src/gnuplot.opt: Add breaders.obj to the list.

2005-01-19  Dietmar Warning  <warning@danalyse.de>

	* src/util.c: Correct the GetUserName call for windows.

2005-01-11  Shigeharu Takeno  <shige@iee.niit.ac.jp>

	* term/tgif.trm: Fix two bugs related to font handling.

2005-01-11  Ethan Merritt  <merritt@u.washington.edu>

	* demo/mousevariables.dem demo/keystroke.dem: Fix incorrect termination
	logic in the keystroke demo.

	* src/graphics.c (boundary): Rather than turning off the key altogether
	if the contents seem to be too big to fit, fall back to something half
	way plausible and also print an warning message. Fixes (or at least
	addresses) bug #1058117.

2005-01-11  Harald Harders  <h.harders@tu-bs.de>

	Apply updated SourceForge patch #1023783
 
	* configure.in: Check for which libpdf version is present; check
	whether <pwd.h> is present.

	* src/util.c src/util.h: New routine (char *) getusername() gets
	user name from environment or from passwd file.

	* term/pdf.trm (PDF_init) term/post.trm (PS_init): Store username
	and other envelope information in the PDF dictionary structure of
	the output file.  New routine PS_escape_string() to ensure that 
	character strings entered in the PDF dictionary are legal strings.

	* term/pdf.trm (PDF_init PDF_reset): Use either PDF_begin_document
	or PDF_open_file depending on which version of libpdf is available.
	Ditro for PDF_end_document or PDF_close.

2005-01-11  Harald Harders  <h.harders@tu-bs.de>

	* src/src/set.c src/term.c src/unset.c term/post.h term/post.trm
	term/pslatex.trm: SF patch # 1098256 "Introduce struct that takes all
	postscript terminal options". This patch introduces the struct
	ps_params_t that takes all postscript terminal options, e.g., color,
	blacktext, pslevel, rounded, fontsize, ... This is useful when
	different terminals share the same portion of code.

2005-01-10  Daniel Sebald  <daniel.sebald@ieee.org>

	* src/gadgets.c src/gadgets.h src/set.c (set_margin) src/show.c
	(show_margin) src/unset.c (unset_margin): Specify and store plot
	margins as float rather than int.

2005-01-10  Daniel Sebald  <daniel.sebald@ieee.org>

	* src/graphics.c demo/image.dem: Correct a problem with scaling of
	images from 'with image'.

2005-01-08  Ethan Merritt  <merritt@u.washington.edu>

	* src/term.c (term_start_multiplot): Replace keywords "rowmajor" and
	"columnmajor" with "columnsfirst" and "rowsfirst", respectively.

	* docs/gnuplot.doc: Correct the description of row and column layout
	'set term multiplot layout <rows>,<cols> {rowsfirst|columnsfirst}'

2005-01-08  Harald Harders  <h.harders@tu-bs.de>

	* src/pm3d.c src/term.c src/term_api.h term/epslatex.trm term/post.trm
	term/pslatex.trm: SF patch #1098252 "Use variable gppsfile for
	postscript output". This patch uses the variable gppsfile (formerly
	postscript_gpoutfile) instead of gpoutfile for all PostScript output.
	This is very useful for terminals that produce two files where one of
	them is PostScript (for example pslatex and epslatex).
	 
	* src/color.c src/pm3d.c src/term.c src/term_api.h term/epslatex.trm
	term/post.trm term/pslatex.trm: SF patch [ 1098249 ] "Rename
	postscript_gpoutfile to gppsfile". This patch renames the handler
	'FILE *postscript_gpoutfile' to 'gppsfile' since the old variable name
	is too long for more often use.

2005-01-05  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/util.h (try_to_get_string): Add missing 'void' to prototype
	argument list.

	* term/x11.trm: #include <sys/select.h>, if it exists.

	* src/stdfn.h: #include <sys/param.h> before checking if PATH_MAX
	is defined (definition may be in there...), rather than inside the
	fallback definition only.

	* term/svg.trm (SVG_init): Updated DOCTYPE name and reference to
	current standard: SVG 1.1. Added an XMLNS namespace declaration to
	satisfy requirements for XML documents.

2005-01-05  Bastian Maerkisch  <bmaerkisch@web.de>

	* src/os2/gclient.c: Some more cleanup: Removed some unused variables
	and unused code which eliminates a lot of compiler warnings.

2005-01-04  Ethan Merritt  <merritt@u.washington.edu>

	* src/term.c src/term_api.h: Instead of exporting ignore_enhanced_text
	from term.c as a global TBOOLEAN, provide a wrapper routine
	ignore_enhanced(TBOOLEAN flag);

	* src/graphics.c (do_plot) src/graph3d.c (do_3dplot): Call new routine
	ignore_enhanced() rather than directly setting a variable inside term.c.

	* src/gadgets.h: Add TBOOLEAN noenhanced flag to label_struct.

	* docs/gnuplot.doc src/set.c (set_xyzlabel) src/save.c (save_set_all)
	src/show.c (show_xyzlabel): New suboption `set ... {{no}enhanced}` for
	plot title and axis labels, analogous to the noenhanced option for the
	plot key entries.  This allows, for example, using a filename with
	underscores as part of the plot title.

	* src/graphics.c (do_plot) src/graph3d (do_3dplot): Disable enhanced
	text processing while writing out plot title or axis label text if the
	noenhanced flag is set in the corresponding label_struct.

	* docs/gnuplot.doc: Correct the documentation to say
	'set multiplot layout <rows>,<cols>' (rows/cols were reversed in the
	previous version, and mis-described in the example).

2005-01-04  Bastian Maerkisch  <bmaerkisch@web.de>

	* src/os2/gclient.c: Contains my attempt to implement pattern filling
	for the pm terminal. I gave this a bit of testing, but I have to admit
	that the result looks ugly together with the widelines option. But
	here you go anyway as 'widelines' has to be improved later anyway. It
	should work fine without 'widelines'...

	* src/os2/gnupmdrv.c: Newer versions of gcc on OS/2 no longer have
	fcloseall(), but _fcloseall().

	* src/os2/gclient.c src/os2/dialogs.c src/os2/print.c: Clean up by
	removing some unused variables and code (some put into #if 0/#endif);
	some minor  changes to  layout - this basically removes anoying warning
	messages during compilation.

2004-12-31  Ethan Merritt  <merritt@u.washington.edu>

	* term/estimate.trm src/term.h: New pseudo-terminal driver whose sole
	function is to parse a string in enhanced text mode and return the
	number of character-widths in the resulting output text.

	* configure.in NEWS src/term_api.h src/term.c (estimate_strlen):
	New routine estimate_strlen(char *text). Its default behaviour is to
	return strlen(text). But if the currently active terminal is in
	enhanced text mode, and the current plotting context does not disable
	enhanced text, then instead it calls the estimate.trm pseudo-terminal
	term->put_text(text) in order to determine the approximate width of
	the eventual output string.  This feature may be disabled using
	./configure --disable-strlen_estimation

	* src/graph3d.c src/graphics.c: Where strlen(text) is used to reserve
	space on the plot (e.g. leaving room for tic labels or key box entries)
	call the new routine estimate_strlen(text) instead.  This allows more
	accurate plot layout in enhanced text mode. The improvement is 
	particularly noticible if the y-axis tic format uses enhanced text mode.
	
	* term/x11.trm (X11_options ENHX11_put_text): Try harder to determine
	what the default fontsize is so that string lengths can be estimated.

2004-12-30  Ethan Merritt  <merritt@u.washington.edu>

	* src/term_api.h term/README: Add a new terminal flag bit 
	TERM_ENHANCED_TEXT that is set whenever the terminal is currently
	operating in enhanced text mode. The will allow improved estimation of
	text string length by the core code.

	* aquaterm.term dumb.trm gd.trm pdf.trm pm.trm post.trm svg.trm x11.trm:
	Set or clear TERM_ENHANCED_TEXT flag in term->options() code
	that parses the "{no}enhanced" terminal option.

2004-12-29  Ethan Merritt  <merritt@u.washington.edu>

	* src/mouse.c (MKSTR): Do not allow embedded newlines in the format
	used for tracking mouse motion via an extra status line at the bottom
	of the plot window. Extra newlines freeze gnuplot_x11 badly.

2004-12-23  Ethan Merritt  <merritt@u.washington.edu>

	* term/ggi.trm (GGI_fillbox GGI_set_color): Implement color selection
	by RGB values. Implement filled boxes.  The GGI project seems moribund,
	so support of other new gnuplot features like polygons is unlikely.

2004-12-22  Ethan Merritt  <merritt@u.washington.edu>

	* src/mouse.c: Remove unused routine event_print().

	* src/mousecmn.h: Remove unused event types GE_stderr, GE_stdout,
	GE_cmd, and unused field text[100] in struct gp_event_t.

2004-12-21  Ethan Merritt  <merritt@u.washington.edu>

	* term/ggi.trm (GGI_replot) src/mousecmn.h src/mouse.c (do_event):
	Remove the one and only instance of GE_cmd as an event type, used
	by ggi.trm to trigger a replot. Create new type GE_replot instead.

	* term/ggi.trm (GGI_set_color): Convert to newer API for set_color.

2004-12-21  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/emf.trm (EMF_filled_polygon): Renamed macro META_POLYGON to
	EMF_POLYGON, to avoid conflict with Win32 headers.

2004-12-21  Petr Mikulik  <mikulik@physics.muni.cz>

	* NEWS docs/gnuplot.doc src/pm3d.h src/pm3d.c src/save.c src/set.c
	src/show.c: New suboptions 'set pm3d corners2color min|max'.

2004-12-20  Ethan Merritt  <merritt@u.washington.edu>

	* term/fig.trm (FIG_put_text) term/gd.trm (PNG_put_text, ENHGD_FLUSH):
	Modify vertical centering text to match most other terminal types.
	This causes text rotation to occur about the vertical midpoint, as in
	the post, x11, pdf, and other terminals. (Bug #1086549)

2004-12-20  Bastian Maerkisch  <bmaerkisch@web.de>

	* term/pm.trm (PM_set_color): Reflect recent changes of parameters in
	term entries.

	* src/os2/gnupmdrv.h src/os2/gclient.c: gnupmdrv.c and gclient.c both
	used to define variable bWidelLines, but it should be the same one.
	This patch adds an 'external' declaration in gnupmdrv.h, and removes
	the definition from gclient.c.

	* src/os2/gclient.c: Within GnuplotPM  "Options->Gnuplot docs...", it
	did not open gnuplot.inf when using NewView, a widely used view.exe
	replacement. Replaced the fixed sized buffer solution with code using
	a dynamic buffer.

	* src/os2/gclient.c: This fixes text rotation for the pm terminal. The
	variable bHorz, which used to indicate horizontal text, has now been
	removed completely. Now pm terminal behaves similar to the postscript
	terminal.

2004-12-15  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/parse.c (push_vars): Conditionalize definition on GP_ISVAR.
	(parse_primary_expression): Conditionalize use of push_vars and
	action PUSHV on GP_ISVAR.

2004-12-14  Ethan Merritt  <merritt@u.washington.edu>

	* demo/Makefile.am.in: Add rainbow.html and pointsize.html to the
	target list for "make html".

2004-12-10  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/command.c (update_command): Fixed handling of optional
	second filename argument broken during introduction of
	try_to_get_string().

2004-12-08  Shigeharu Takeno  <shige@iee.niit.ac.jp>

	* term/tgif.trm: Update option parsing to be order-independent.
	Add monochrome and linewidth options.

2004-12-07  Ethan Merritt  <merritt@u.washington.edu>

	* term/emf.trm: Implement term->set_color(), term->filled_polygon,
	and term->fillbox() for the emf terminal.  This does not provide PM3D
	palette support, but it does allow coloring by explicit RGB and plot 
	styles that use filled boxes.

2004-12-07  Petr Mikulik  <mikulik@physics.muni.cz>

	* demo/pm3d.dem: Turn on colorbox in the demo of corners2color, and
	position it at the bottom of the page.

2004-12-05  Ethan Merritt  <merritt@u.washington.edu>

	Run valgrind to find memory leaks.

	* term/x11.trm (X11_make_palette): Free palette gradient after sending
	it to gnuplot_x11.  Do other drivers have similar leaks?
	
	* src/set.c (set_cntrparam): Free old dynamic contour level array before
	getting a new one.
	
	* src/set.c (set_xyzlabel): Free dynamic label string after copying it
	to a static label structure.

	* src/parse.c (temp_at): Add a garbage-collection step to the 
	deallocation of temporary storage for expression evaluation. I wish I
	understood this well enough to guarantee the correctness of scavenging,
	but empirical tests indicate that no double-free errors are triggered.

2004-12-04  Ethan Merritt  <merritt@u.washington.edu>

	Run valgrind to find codepaths that trip over uninitialized variables.

	* src/parse.c (const_express) src/set.c (set_xyzlabel set_label):
	src/eval.c src/eval.h: Move set/clear of flag STRING_RESULT_ONLY up
	one level in the call chain.

	* src/temp_api.h src/color.h src/graphics.c (init_histogram)
	src/plot2d.c (cp_alloc) src/plot3d.c (sp_alloc):
	More complete initialization of dynamic and gp_alloc()ed structures.

2004-12-03  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (xtick2d_callback ytick2d_callback): Fix bug
	reported by Mike Kay: if the grid was active and the key box was
	entirely above or to the left of the graph itself, then an extraneous
	grid line was drawn connecting the key box to the graph.

	* src/set.c (set_palette): Fix bug #1077699 - parser was skipping
	whatever token came after  "gamma <val>".

2004-12-03  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/fig.trm (FIG_set_color): Fix a C99-ism. Thanks to Shigeharu
	Takeno for spotting this.

2004-12-02  Ethan Merritt  <merritt@u.washington.edu>

	* term/gd.trm: Keep track of current rgb values in parallel to the
	current linetype, since we can no longer count on regenerating the
	former from the latter.

	* term/x11.trm: Add missing X resource to the table in the docs.

	* configure.in: Remove obsolete messages relating to old png driver.

2004-12-01  Ethan Merritt  <merritt@u.washington.edu>

	Add colorspec to linetype, and hence to all 2D and 3D plot elements.
	These changes all depend on configuration with --enable-pm3d
	Add support and demo example of using explicit RGB colors or gnuplot's
	internal pre-defined color names:
	    set style line 1 lt rgbcolor "violet" lw 2
	    set style line 2 lt rgbcolor "#FFA080" lw 2   # salmon pink

	* src/term_api.h: 
	Add new field "struct t_colorspec pm3d_color" to lp_style_type, so that
	any plot element with an associated line type can use palette-based or
	RGB colors.

	* src/term.c (term_apply_lp_properties):
	Check lp_style_type.use_palette flag, and if set apply the colorspec
	rather than a simple linetype color.

	* src/misc.c (lp_parse parse_colorspec):
	Call parse_colorspec() as part of normal line type parsing. This allows
	"lt {rgbcolor 'name'} | {palette {cb <val> | frac <val> | z}}" anywhere
	that "lt <val>" is currently valid.

	* src/graphics.c (do_plot plot_boxes plot_c_bars do_key_sample):
	Everywhere that we would normally call t->linetype(), check use_palette
	and instead call apply_pm3dcolor()
	Everywhere that we would normally call t->fillbox(), check use_palette
	and instead call t->filled_polygon() via new routine fill_corners()

	* src/plot2d.c (eval_plots): Do not allow "lt palette z" in 2D plots

	* src/save.c src/show.c: 
	save/show colorspec options associated with line styles and text colors

	* src/set.c:
	Allow text color to use full colorspec options.

	* src/tables.c src/tables.h: New function reverse_table_lookup() that
	returns the keyword associated with a table value; this is used to look
	up the colorname associated with an RGB value.

	* NEWS docs/gnuplot.doc: Document new functionality and syntax.

	* demo/colorwheel.dem:
	Set palette mode to standard HSV color wheel and define common colors as
	macros. Allows terminal-independent commands such as
		plot sin(x) with lines @orange

	* demo/rainbow.dem:
	Demonstrate two approaches to defining terminal-independent colors for
	plot elements. (1) Load 'colorwheel.dem' to create a palette from which
	colors can be selected. (2) Use the new colorspec type RGB to request
	specific named colors, as in
	    set style line 1 lt rgbcolor "sea-green"
	This only works well on terminals that support full RGB color modes.
	Some palette-based terminals will approximate the requested color using
	whatever palette color is closest, but the results may not be pleasing.

2004-12-01  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot2d.c (eval_plots) src/plot3d.c (eval_3dplots): Add 
	END_OF_COMMAND check before trying to parse possible backwards
	compatibility options.  Fixes incorrect error message if text
	option parsing consumes the rest of the command line.

2004-11-30  Petr Mikulik  <mikulik@physics.muni.cz>

	* term/post.trm docs/Changes.doc: Typos.

2004-11-29  Petr Mikulik  <mikulik@physics.muni.cz>

	* term/pm.trm src/os2/gclient.c: Changes for the new colorspec type
	TC_RGB. Currently, they are dummy in gclient.c -- to be implemented.

2004-11-27  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc docs/gnuplot.texi: Re-format a large section of text
	dealing with binary files.  The previous layout caused PDF output to
	treat the whole section as quoted monospace text, as for a code example.

2004-11-27  Ethan Merritt  <merritt@u.washington.edu>

	* src/color.h: Add new colorspec type TC_RGB, allowing colors to
	be specified as an RGB triple stored as (RR<<16)+(GG<<8)+BB with
	red, green, and blue components running from 0 - 255.

	* src/gadgets.c (apply_pm3dcolor) src/gadgets.h: Pass RGB color
	specifications to terminals via the new API for term->set_color().

	* src/gplt_x11.c src/gplt_x11.h term/*.trm (set_color):
	Implement set color to specified RGB triple in these terminals
		aquaterm gd metapost pdf post svg x11
	Somebody please have a look at doing the same for
		cgm pstricks win

2004-11-26  Ethan Merritt  <merritt@u.washington.edu>

	* src/term_api.h term/README: Change from term->set_color(double gray)
	to term->set_color(struct t_colorspec *colorspec).  This sets the stage
	for allowing color specification mechanisms other than a PM3D palette.
	The immediate intent is to allow direct requests for RGB color values.
	
	* term/*.trm: Convert all terminal types providing set_color() to the
	new API. No change in terminal behavior or capabilities.
	Terminals affected:
		aquaterm cgm fig gd metapost pdf post pslatex svg 
		tgif vgagl win x11 pstricks

	* src/color.c (set_color): This is the only routine that calls 
	term->set_color. Convert it to pass a colorspec pointer rather than a
	palette gray value.

2004-11-25  Ethan Merritt  <merritt@u.washington.edu>

	* src/util3d.h: map3d_xy_double is needed independent of WITH_IMAGE.

2004-11-24  Ethan Merritt  <merritt@u.washington.edu>

	src/gplt_x11.c: Set background color for pattern-fill explicitly each
	time.

	term/svg.trm (SVG_GroupOpen SVG_DefineFillPattern): Allow palette colors
	to be used in pattern fill.

2004-11-23  Ethan Merritt  <merritt@u.washington.edu>

	src/gplt_x11.c: Initialize mouse_format to null string. Fixes bug that
	in some circumstances the mouse position is printed as random garbage.

2004-11-21  Ethan Merritt  <merritt@u.washington.edu>

	Rearrange code so that pm3d support routines are available to both 2D
	and 3D plots.  The addition of pm3d code to 2D plots began in portions
	of the WITH_IMAGE patch; remove the dependence on WITH_IMAGE to prepare
	for more general use of pm3d colorspecs in 2D plots.
	Introduce general checking for pm3d colorspecs in 2D plots. This fixes
	a bug that the colorbox could only be drawn for "with image" plots if
	the *first* plot used pm3d; subsequent plots were not checked.
	Also, pm3d colorspecs were already usable for text coloring in 2D, but
	no colorbox was drawn if they were used.  Now it is.

	* src/color.h src/gadgets.h  : Move definition of t_colorspec to color.h

	* src/color.h src/color.c src/graph3d.c src/graphics.c plot2d.c: 
	Remove #ifdef WITH_IMAGE from several code segments that are useful for
	plot styles other than image.

	* src/misc.c src/set.c src/misc.h: Move parse_colorspec from set.c
	to misc.c and export it for use when parsing "with" options in both 
	2D and 3D.

	* src/plot3d.c src/pm3d.c src/pm3d.h src/graph3d.c: 
	Move set_plot_with_palette and is_plot_with_palette from plot3d.c into 
	pm3d.c so they can be shared by 2D and 3D code.

	* src/graphics.c: Check for is_plot_with_palette() and modify layout of
	2D plots to include colorbox if it returns TRUE.

	* src/color.c src/gadgets.c src/gadgets.h src/graph3d.c src/graphics.c:
	Rename apply_textcolor() to be apply_pm3dcolor(), since it is usable for
	any plot element requiring a palette-based color.

2004-11-20  Ethan Merritt  <merritt@u.washington.edu>

	* src/datafile.c (add_key_entry): Make sure all fields of newly
	allocated structure are initialized.

	* src/graph3d.c (do_3dplot) src/plot3d.h: Call utility function 
	is_plot_with_palette rather than making plot_has_palette a global int.

	* src/util3d.h: map3d_xy_double is needed independent of WITH_IMAGE.

	* demo/pm3d.dem: Turn off colorbox in the demo of corners2color.

2004-11-13  Ethan Merritt  <merritt@u.washington.edu>

	* src/specfun.c (f_erf f_erfc f_normal): Replace in-line rough
	approximation for erf() and erfc() with calls to the internal
	routines that compute these values more accurately. This is only
	relevant to platforms that do not already provide math library
	routines erf() and erfc(). Empirical tests show that this change
	decreases the error relative to the double precision library
	erf routine from O(10^-8) to O(10^-16).
	Thanks to Dietmar Warning <warning@danalyse.de>

2004-11-12  Ethan Merritt  <merritt@u.washington.edu>

	* term/svg.trm (ENHsvg_writec): Escape character & to be &amp; in
	output stream. '<' and '&' are the only escaped characters so far,
	and only in enhanced text mode.

2004-11-12  Dietmar Warning  <warning@danalyse.de>

	* src/specfun.c (inverse_error_func): Replace obsolete attribution of 
	algorithm used for this function.

	* src/util3d.c (map_xy_double): This function is needed independent of
	the image code, so remove #ifdef WITH_IMAGE.

2004-11-11  Ethan Merritt  <merritt@u.washington.edu>

	* demo/datastrings.dem: Add example of using a column both as a 
	numerical value and a string (use y value as a label).

	* src/graphics.h: New TBOOLEAM title_is_suppressed in plot structure
	src/graphics.c (find_maxl_keys do_plot) 
	src/datafile.c (df_set_key_title) plot2d.c (cp_alloc eval_plots):
	Keep an explicit flag indicating whether or not the key should contain
	an entry for this plot.

2004-11-11  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* docs/doc2texi.el (d2t-get-terminals): Fix search pattern for
	point where to insert terminal drivers after change of indentation
	level in gnuplot.doc.

	* docs/Makefile.in (TERM_H): New variable, points to term.h file
	in the src directory.
	(term.h): Rule generating this file disabled.
	(gnuplot.html, gnuplot.info): Removed superfluous dependencies on
	gnuplot.doc.
	(gnuplot.texi): Run Emacs inside source directory --- building
	gnuplot.texi in an out-of-source build tree is futile, and never
	really worked.
	(doc2gih.o, doc2hlp.o, doc2ipf.o, doc2rnh.o, doc2rtf.o): Build
	online documentation tailored to actual program by including the
	real term.h, instead of a mangled copy.
	(BUILT_SOURCES): Removed term.h from the list.

	* docs/gnuplot.texi: Rebuilt.

	* docs/gnuplot.doc: Cleared some whitespace-only lines.

2004-11-10  Ethan Merritt  <merritt@u.washington.edu>

	* src/stdfn.h
	* src/eval.c (gp_exp) src/specfun.c (f_gamma) src/standard.c (f_tanh):
	Rename constant MINEXP to be E_MINEXP, since this is more in line with
	the terminology used in standard math libraries. Only fall back to the
	current assumption that E_MINEXP == -88 if the build environment does
	not provide a definition for DBL_MIN_10_EXP, probably in <float.h>.
	On most machines this means that gnuplot's gamma() function should now
	have the same allowed input domain as exp(lgamma()).

2004-11-10  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/save.c: Fix y-axes reversal when saving during 'set view map'.

2004-11-08  Ethan Merritt  <merritt@u.washington.edu>

	* src/term.c (do_arrow test_term): Do not attempt filled arrowheads if
	the current terminal does not provide term->filled_polygon(). Exercise
	filled arrowhead code in the 'test' command.

	* src/graphics.c (plot_image_or_update_axes): Do not attempt to draw
	rotated quadrangles if the current terminal does not provide
	term->filled_polygon().

	* docs/gnuplot.doc: Not all terminals support double-headed arrows.

2004-11-08  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/hidden3d.c (build_networks): Fix 'with impulses' drawing
	style --- was off by one.

2004-11-07  Ethan Merritt  <merritt@u.washington.edu>

	* src/term.c (enhanced_recursion): Always allow backslash to escape the
	5 special formatting characters @^_~& in postscript enhanced text mode.
	This breaks certain character sequences in Shift-JIS, but the 
	alternative makes these characters unavailable for all other encodings.

	* src/graphics.c (plot_vectors): Fix bug which drew a head on the tail
	of arrows whose original heads were clipped. Bug #1062158.

2004-11-07  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gnuplot.doc: Typos.

	* term/tgif.trm: Replace "set nomultiplot" by "unset multiplot" in the
	docs section.

2004-11-06  Ethan Merritt  <merritt@u.washington.edu>

	String variables - command line macros
	--------------------------------------
	Command line macros are indicated by the character @ preceding a
	string variable. When the command line is read in, these macros are
	expanded by replacing the string @<varname> with the contents of the
	string variable <varname>. Macros can be nest up to 4 levels deep.
	Macros are not expanded inside single quotes or double quotes, but
	they are expanded inside backquotes.

	* configure.in: --enable-macros selects #define GP_MACROS

	* demo/macros.dem docs/gnuplot.doc: Examples and documentation.

	* src/command.c (do_line): Call new routine string_expand() that steps
	through input_line, expanded macros as it goes. 

	* src/save.c (save_variables__sub): Save STRING variables in single
	quotes rather than in double quotes.  That way when the saved values
	are loaded, no backquote substitution is triggered.

	* src/save.c src/set.c src/show.c src/unset.c src/tables.h src/tables.c
	src/command.c src/command.h: Global TBOOLEAN expand_macros to turn
	expansion on or off via new commands '{un}set macros'.

2004-11-02  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c: Use 0 rather than NULL in initializing a union, to make
	gcc happy.

	* src/plot3d.c: #include "plot2d.h" so that store_label is imported.

	* src/internal.c (sprintf_specifier): Add a useless return statement
	to make gcc happy.

2004-11-01  Daniel Sebald  <daniel.sebald@ieee.org>

	* src/datafile.c (df_readbinary): Do not try to access Z coordinate
	data in 2D mode.

2004-10-31  Ethan Merritt  <merritt@u.washington.edu>

	* src/datafile.c (df_readbinary): Fix incorrect indexing of 2D
	rotation matrix.

	* src/mousecmn.h: Remove trailing comma from enum definition.

	* src/color.c (cbtick_callback) src/graph3d.c (do_3dplot xtick_callback
	ytick_callback ztick_callback map3d_position plot3d_vectors)
	src/mouse.c (nearest_label_tag):
	DEC cc is much pickier about mixing (unsigned int) and (int) across
	function calls or call-backs. Clean up the parameter usage to allow
	compilation under DU 4.0

	* src/internal.c (f_concatenate f_sprintf): Provide fallback for 
	configurations that don't support snprintf().

2004-10-29  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc: Fix indentation level of terminal types when
	converted to pdf.  Add mention of string variables in the documentation
	for 'set label'.

	* src/gplt_x11.c (pr_exportselection) term/x11.trm:
	Add a test for X resource gnuplot*exportselection and disable exporting
	the plot windows to the X clipboard if it is set to "off" or "false".

	* NEWS: Catch up with recent work.

2004-10-29  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/term.c docs/gnuplot.doc: Reset values of 'set size' and
	'set origin' after 'unset multiplot' to the values as they were at
	'set multiplot layout'.

2004-10-28  Ethan Merritt  <merritt@u.washington.edu>

	* src/datafile.c (df_open): initialize_user_spec() is needed whether or
	not the input mode is binary. Fixes bug reported under Windows.

2004-10-27  Ethan Merritt  <merritt@u.washington.edu>

	String variables - extra features
	---------------------------------
	Autoconversion of strings to numerical values if encountered during
	evaluation of a numerical expression.  ("3" + "4.5" == 7.5) is true.
	Autoconverion of integers to strings if encountered as an operand for
	string concatenation. ("file" . 4 eq "file4") is true.

	* configure.in: GP_STRING_VARS is #defined as 2 if these extra features
	are desired. Defining it as 1 leaves the basic feature set enabled but
	disables the extra stuff.

	* docs/gnuplot.doc src/eval.c src/eval.h src/internal.c src/standard.c:
	New routine pop_or_convert_from_string(), aliased to pop() during
	numerical evaluation. Treat INTGR operand to f_concatenate as a
	special case, promoting it to STRING.
	
	* src/parse.c (const_express):
	Suppress possible autoconversion to a number if the caller specifically
	expects a string value to be returned.

2004-10-27  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/term.c docs/gnuplot.doc: New 'set multiplot layout' options
	'downwards' and 'upwards'.

2004-10-26  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc: Add separate section with indexed entry for 
	discussion of quote marks.

2004-10-25  Ethan Merritt  <merritt@u.washington.edu>

	String variables - basic functionality
	--------------------------------------
	Allow gnuplot variables to contain strings, and allow expressions
	to operate on strings. Provide two pre-defined string-valued functions;
	sprintf() is a wrapper for the the C language formatting routine of the
	same name, gprintf() is a wrapper for the existing gnuplot-defined
	format specifiers.  All changes are bracketed by #ifdef GP_STRING_VARS.
	Most places where gnuplot previously required a string constant will
	now also accept a string variable or a string-valued expression.

	* docs/gnuplot.doc: 
	* src/gp_types.h: STRING variable type

	* src/internal.c src/internal.h src/eval.c src/eval.h src/parse.c
	string operators (A . B) (A eq B) (A ne B) 
	string functions sprintf() gprintf()
	
	* src/util.c (try_to_get_string) src/util.h: Modify the routine
	try_to_get_string to accept string variables and functions. This one
	place handles the syntax change for most gnuplot commands.
	The main exceptions are 'plot', 'splot', and 'set label', which are
	handled separately.

	* src/scanner.c: accept . as a binary operator (string concatenation)

	* src/datafile.c: evaluate string-valued functions in a 'using' spec

	* src/mouse.c: set string variable MOUSE_CHAR when a key is pressed

	* src/plot2d.c: accept a string variable 'plot <foo>'

	* src/plot3d.c: accept a string variable 'splot <foo>'

	* src/set.c: accept a string variable in 'set label <foo>'
	
	* src/standard.c: int_error if a unary arithmetic operator is
	applied to a string.

	* demo/mousevariables.dem demo/keystroke.dem: Demo use of MOUSE_CHAR
	to treat keystrokes in the plot window as strings.

	* demo/stringvariables.dem: Demo use of constant strings or string-
	valued functions as plot symbols.

2004-10-25  Harald Harders  <h.harders@tu-bs.de>

	* docs/gnuplot.doc: Add labels for "set term push", "set term pop".
	SourceForge patch #1052788.

2004-10-23  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc: Reorganize the docs to give a separate section to
	the list of terminal types. This change is not visible to the internal
	'help' command, but improves the usability of the pdf and tex-based
	documentation.

2004-10-22  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc: A very preliminary update of the "What's New"
	section of the docs to track changes since the version 4.0 release.

2004-10-21  Harald Harders  <h.harders@tu-bs.de>

	This patch introduces the possibilty to move many kinds of texts by an
	offset in an arbitrary coordinate system. For example, tic marks, the 
	title, and labels can be moved by an offset given in 'character',
	'screen', 'graph', 'first', or 'second' coordinate system.
	SourceForge patch #993422.
	
	* docs/gnuplot.doc
	
	* src/axis.c (get_position get_position_default):
	New routine that accepts a default coordinate type when parsing offsets.

	* src/axis.h: Add offset structure to axis tics.
	* src/gadgets.h: Add offset structure to text labels.

	* src/color.c (cbtick_callback draw_color_smooth_box)
	* src/gadgets.c (get_offsets)
	* src/save.c (save_set_all save_tics)
	* src/set.c (set_label set_timestamp set_tic_prop set_xyzlabel 
	             new_text_label parse_label_options parse_histogramstyle)
	* src/show.c (show_label show_histogram show_xyzlabel show_ticdef)
	* src/unset.c (unset_tics unset_axislabel_or_title)

2004-10-20  Harald Harders  <h.harders@tu-bs.de>

	Introduce a new coordinate system 'character' that uses character width
	and height as units. It is a 2d coordinate system similar to 'screen'.
	The origin is the same as for 'screen'. SourceForge patch #993411.
	The intended use is for setting label and text offsets in terms of 
	character size, and generalizing this to all places where an offset is
	legal.
	
	* NEWS docs/gnuplot.doc:
	* src/axis.h src/axis.c (get_position_type) src/gadgets.h:
	New coordinate system "character".

	* src/graph3d.c (get_arrow3d place_labels3d place_arrows3d): 
	* src/graph3d.c (map3d_getposition map3d_position):
	Track 3D coordinates internally as (int) rather than (unsigned int) so
	that out-of-bounds on the negative side can be detected. Interpret
	character offsets.

	* src/save.c (save_set_all) src/show.c (show_position show_arrowstyle):
	* src/graphics.c (map_position_double): Interpret character offsets.

2004-10-20  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (pr_font): Fix bug that whatever fallback font was used
	for an unrecognized font request, that fallback would become the default
	font for all future requests.

2004-10-19  Juergen Wieferink <wieferink@freenet.de>

	* src/set.c (parse_label_options): If the label has an associated point,
	allow its type to be specified by "linestyle <n>".

2004-10-19  Per Persson <persquare@mac.com>

	Adding enhanced text support to terminal aqua.

	* term/aquaterm.trm (ENHAQUA_put_text, ENHAQUA_open, ENHAQUA_flush,
	ENHAQUA_writec): Added.

	* docs/gnuplot.doc Add aqua to list of terminals with enhanced option.

2004-10-18  Volker Dobler  <v.dobler@web.de> 
            Ethan Merritt  <merritt@u.washington.edu>

	New plot style variant that reads individual point sizes from specified
	input column. Examples:

	    plot 'foo' using 1:2:3 with points pt 5 pointsize variable
	    splot 'foo' using 1:2:3:4 with linespoints pt 5 ps variable
	    splot 'foo' using 1:2:3:4:5 with points pt 5 ps variable lt palette

	* NEWS docs/gnuplot.doc: Document new variant of line/point style in
	which the point size is variable, with the size of each point read from
	an extra column in the input file.

	* demo/all.dem demo/pointsize.dem: Demo for 2D and 3D plots with 
	variable point size and pm3d colors.

	* src/gp_types.h: Define storage location for point size info in
	struct coordinate (overload xlow).

	* src/graph3d.c (plot3d_points plot3d_points_pm3d): Check for variable
	pointsize request and change point size before plotting.

	* src/graphics.c (do_plot plot_points): Check for variable pointsize
	request and change point size before plotting and in plot key.

	* src/misc.c (lp_parse): Parse "pointsize variable" in with spec.

	* src/plot2d.c (get_data eval_plots): Allow 3 columns of input for points,
	with the extra column holding point size.

	* src/plot3d.c (get_3ddata): Allow 4 columns of input for points with
	variable point size in 4th column, plus a possible 5th column of pm3d
	color information.

	* src/save.c (save_set_all) src/show.c (show_linestyle): Print or save
	"pointstyle variable" characteristic of line style.

2004-10-18  Ethan Merritt  <merritt@u.washington.edu>

	* term/be.trm term/cgm.trm term/emf.trm term/epslatex.trm term/fig.trm
	term/gd.trm term/metapost.trm term/tgif.trm term/win.trm term/x11.trm:
	Add a check in TERM_pointsize() so that negative point size is reset to
	size 1.0.  This has always been the case for the generic do_pointsize()
	routine in term.c, but not all of the individual terminals did likewise.

2004-10-17  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot2d.c (eval_plots) src/plot3d.c (eval_3dplots):
	More stringent syntax test for bare numbers indicating line
	type in backwards-compatibility mode.

2004-10-17  Juergen Wieferink <wieferink@freenet.de>

	* src/scanner.c (scanner): Terminate scan properly if an empty
	substitution occurs at the end of a line. bug #1045695 

2004-10-16  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot3d.c (get_3ddata):  Reorganize the code so that fewer
	assumptions are made about what the plot must be based on the
	number of columns, and so that the various 3D mapping modes share
	the interpretations of columns other than the first three.

	src/plot3d.c (get_3ddata): Initialize variables to shut off stupid
	compiler warnings.

	src/unset.c: #include hidden3d.c to pick up reset_hidden3doptions.

2004-10-15  Ethan Merritt  <merritt@u.washington.edu>

	* src/save.c (save_set_all):  Do not try to save the current title and
	text properties of histograms.  This is not part of the permanent style.
	Fixes strangeness with "test palette".

2004-10-14  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot2d.c (get_data eval_plots): Defer adjustment of histogram 
	ranges until after the input file has been checked for valid data.
	(fixes bug #1046894)

	* src/datafile.c (df_parse_string_field): Handle missing field in 
	input file more gracefully. (bug #1046894)

	* src/graph3d.c (map3d_position_r): Remove unused variables.

2004-10-13  Harald Harders  <h.harders@tu-bs.de>

	* src/graph3d.c (map3d_position_r get_arrow3d):
	Change the interface of the function map3d_position_r() to be similar 
	to map_position_r().  Now, map3d_position_r() does not need to get the 
	startpoint.  This will make it easier to use it for all kinds of 
	relative coordinates as text offsets.

	* src/graphics.c (get_arrow):  map_position_r already handles the
	relative position; no need to duplicate it in get_arrow.

	* docs/gnuplot.doc: Mention that relative coordinates in log scale
	imply a multiplicative rather than an additive offset.

2004-10-12  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (place_labels): Add a TBOOLEAN flag to indicate whether
	labels should be clipped against the current axis limits. Labels
	generated by "set label <foo>" are never clipped; labels generated by 
	'plot with labels' are clipped.

	* src/graphics.c (fill_between): Improve clipping to handle 1st/2nd axes
	and inverted axis range.

2004-10-11  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c (apply_zoom): Fix for reversed y-range in zoom by mouse
	and "set view map".

	* src/graphics.c (do_plot): Better warning for trying to use pm3d in a
	2d plot.

2004-10-08  Petr Tobiska <tobiska@ure.cas.cz>

	* term/metapost.trm (MP_arrow): Handle double-ended arrows also.

2004-10-05  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (pr_font): Release previous font every time a new one
	is requested. This feels wrong to me since we know the old font will be
	used again very soon, but otherwise there is a serious memory leak.

	* src/gplt_x11.c (PaletteMake): (Daniel Sebald <daniel.sebald@ieee.org>)
	Fix another tiny memory leak.

	* src/plot3d.c (get_3ddata): Add missing #ifdef EAM_DATASTRINGS.

	* configure.in: If --disable-datastrings is selected, then turn off 
	histogram support also since it is crippled without the 
	datastrings code.

2004-10-05  Petr Mikulik  <mikulik@physics.muni.cz>

	* config/config.cyg config/config.mgw config/config.os2: Added #defines
	EAM_DATASTRINGS and EAM_HISTOGRAMS.

	* src/makefile.all: Added breaders.$(O) to COREOBJS.

2004-10-04  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm (X11_graphics): Initialize font-tracking variable at the
	start of each plot (fixes problems seen with opening multiple plot 
	windows with different default fonts).

2004-10-04  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/gplt_x11.c (process_event): Added missing cmd_tried = 1.

2004-10-03  Daniel Sebald  <daniel.sebald@ieee.org>

	* src/gplt_x11.c (delete_plot): Fix small memory leak.

2004-10-01  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot3d.c (get_3ddata): Allow explicit pm3d palette colors for line
	and point styles in non-Cartesian mapping modes. (bug #1005775)

2004-09-30  Ethan Merritt  <merritt@u.washington.edu>

	* term/gd.trm: Change #ifdef GD2_VERS to #if (GD2_VERS >= 2) everywhere.

	* term/emf.trm (EMF_set_font) term/tgif.trm (TGIF_set_font):
	Fix longstanding problems with the set_font routines;
	interpret font requests of the form ",<size>" as a request to rescale
	the current font to <size>.

2004-09-29  Ethan Merritt  <merritt@u.washington.edu>

	* demo/all.dem:  Remove vector.dem again, since it turns out that it
	breaks for any terminal type whose default value of 'set output' is
	not the current display.

	* demo/world2.dem: Set font explicitly to "Helvetica,7", since some
	terminal drivers do not like the partial font spec ",7".

	* src/hidden3d.c (set_hidden3doptions) src/hidden3d.h 
	src/unset.c (reset_command): New routine reset_hidden3doptions()
	called by "set hidden defaults" and also by "reset".

	* term/post.trm (PS_set_font ENHPS_set_font) term/pdf.trm (PDF_set_font)
	term/svg.trm (SVG_set_font): Do not allow the font to be set to "";
	interpret font requests of the form ",<size>" as a request to rescale
	the current font to <size>.

2004-09-29  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/datafile.c (df_show_binary): In fprintf(), use "%f" not "%lf" for
	doubles.

2004-09-27  Ethan Merritt  <merritt@u.washington.edu>

	* demo/airfoil.dem demo/fillcrvs.dem demo/histograms.dem
	demo/histograms2.dem demo/spline.dem demo/world.dem:
	Replace all instances of outdated syntax, i.e. everything that causes
	errors or warnings if BACKWARDS_COMPATIBLE is not defined.

	* src/plot2d.c (eval_plots) src/plot3d.c (eval_3dplots): Wrap the code
	which interprets bare line+point types with #ifdef BACKWARDS_COMPATIBLE
	(e.g. plot 'foo' with linespoints 3 4).

2004-09-27  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/os2/gclient.c: Fix typo in a #define from the previous massive
	whitespace changes.

	* config/config.os2: Let #define STDC_HEADERS 1.

2004-09-26  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot3d.c (eval_3dplots): Fix logic of default arrow style in the
	case of splot with vectors.

2004-09-25  Ethan Merritt  <merritt@u.washington.edu>

	* src/util3d.c src/util3d.h: Add a text_label pointer to the p_vertex
	structure in order to support labels in hidden3d mode.

	* hidden3d.c (build_networks draw_vertex): Add code to handle plot style
	"with labels" in hidden3d mode.

	* demo/world2.dem demo/srl.dat: New demo to show use of labels with pm3d
	colors and hidden3d mode.

	* demo/all.dem demo/Makefile.am.in: Add vector.dem and world2.dem.

2004-09-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (get_offsets place_labels) src/graphics.h:
	Simplify place_labels by calling a new shared routine.
	Move the support routine get_offsets into gadgets.c as well.

	* src/graph3d.c (plot_labels3d): Simplify place_labels3d by calling
	a new shared routine.
	
	* src/gadgets.c (get_offsets write_label) src/gadgets.h:
	New routine write_label that is shared by both the 2D and 3D code.

	* demo/fit.dem demo/vector.dem demo/histograms2.dem:
	Revise demo instructions slightly to work with the webify script.

	* demo/webify.pl: Use "pause 0" in demo scripts to signal that the
	output file needs to be reset during web page generation.

	* demo/Makefile.am.in: Update list of demos to include in web page
	generation ("make html").

2004-09-20  Ethan Merritt  <merritt@u.washington.edu>

	* configure.in: --enable-with-image requires both pm3d and binary file
	support. Enforce this in the configure script by not allowing with-image
	to be enabled if the other two options have not also been enabled.

2004-09-21  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gnuplot.doc: Fix documentation for multiplot.

	* src/term.c: Better error message for an invalid option of multiplot.

2004-09-20  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc: Fix some minor errors that interfered with 
	latex processing.

2004-09-19  Ethan Merritt  <merritt@u.washington.edu>

	* src/graph3d.c (do_3dplot plot3d_vectors) src/graph3d.h 
	src/plot3d.c (get_3ddata eval_3dplots):  Extend the plotting style
	"with vectors" to apply to 3D plots as well.
	    splot 'data' using <x>:<y>:<z>:<delx>:<dely>:<delz> with vectors \
	          <arrowstyle>
	Only cartesian coordinate mapping is currently supported.

	* docs/gnuplot.doc NEWS: Document extension to 3D.

2004-09-17  Harald Harders  <h.harders@tu-bs.de>

	* term/README term/debug.trm term/gd.trm: Fix typos and add 
	information about enhanced text mode callback entries in TERM_TABLE.

	* term/post.trm:  Move definition of /Rounded to the top of the
	prolog so that it is with the other user-editable definitions.

2004-09-17  Petr Mikulik  <mikulik@physics.muni.cz>

	* NEWS docs/gnuplot.doc src/misc.c: New automatic variable $# gets
	expanded to number of arguments after "call <file>". SF patch 943749.

2004-09-16  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c (set_timestamp set_xyzlabel) src/save.c (save_set_all)
	demo/contours.dem demo/surface1.dem docs/gnuplot.doc:
	Add keyword "offset" to commands of the form
	    old: set xlabel "foo" -1,-1
	    new: set xlabel "foo" offset -1,-1
	This is necessary to pave the way for string variables, as otherwise
	"set title var -1" is mis-parsed as containing the arithmetic expression
	(var-1). To maintain backward compatability, the keyword is optional.

2004-09-16  Harald Harders  <h.harders@tu-bs.de>

	* term/post.trm (delete_ps_fontfile): Remove debugging printout line.

2004-09-15  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot3d.c (get_3ddata) src/graphics.c (boundary) term/x11.trm:
	Add #ifdefs so that ./configure --disable-pm3d will build successfully.

	* term/fig.trm term/epslatex.trm term/pslatex.trm term/metapost.trm
	term/tgif.trm term/pstricks.trm:  Disentangle the ordering of #ifdefs
	in the TERM_TABLE entries (MOUSE is not a subset of PM3D).

	* term/emf.trm: Remove unused label to quiet compiler warnings.

2004-09-15  Konstantin Korikov  <lostclus@ua.fm>

	* NEWS docs/gnuplot.doc src/gplt_x11.c src/set.c src/term_api.h
	src/term.c term/post.trm: Add support for character encoding koi8-u
	(cyrillic koi8 for Ukrainian users).
	SourceForge patch #966815.

2004-09-14  Ethan Merritt  <merritt@u.washington.edu>

	* demo/borders.dem demo/Makefile.am.in: Rewrite the borders demo to 
	terminate after 16 possible settings, to display the border setting in
	a label, and to execute from inside a single demo file rather than a 
	combination of two.  Thanks to Daniel Sebald for identifying that it
	needed an update.

	* src/term.c (do_arrow): Interpret (head < 0) as "draw arrowhead only".
	This allows us to retrace the arrowhead in a different linestyle if
	necessary.

	* term/post.trm (PS_arrow): Add a wrapper for the do_arrow() routine
	so that if the current linestyle is dashed we can retrace the arrowhead
	with a solid line. Addresses bug report #963213.

	* term/pslatex.trm (PSLATEX_arrow): Piggyback on PS_arrow to apply
	the same fix for pslatex.  Any other terminals with dashed lines will
	have to be fixed separately.

2004-09-13  Daniel Sebald  <daniel.sebald@ieee.org>

	* src/datafile.c: Rework the layout of the df_bin_default_columns
	array, so that the binary input code is not sensitive to the order of
	defining plot styles in gp_types.h.

2004-09-13  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c: Trivial cleanup to remove compiler warnings.

	* term/post.trm: Keep track of whether or not the macro definitions
	required for enhanced text mode have been written to the output file
	yet.  If enhanced text mode is enabled after the terminal has already
	been initialized, make sure that the macros are added to the next
	output page.  This allows, for example,
	    setenv GNUTERM post;  gnuplot all.dem > all.ps
	Without this fix, the output pages following the enhanced text demo
	are corrupted. An alternative would be to write the enhanced text
	macros in the %%Prolog for every PostScript output file regardless of
	whether enhanced text mode has been selected.

2004-09-11  Ethan Merritt  <merritt@u.washington.edu>

	* src/command.c src/mouse.c src/parse.c src/parse.h: Rename utility
	function get_udv(char *name) to be add_udv_by_name(char *name), since
	this is what it really does.

	* src/fit.c (setvar): Simplify existing code by using add_udv_by_name.

	* src/set.c (set_termoptions): Update comment explaining this routine.

	* src/plot3d.c (eval_3dplots): Surface plots are no longer the only
	plot style that can have four 'using' specs; remove the error check 
	that incorrectly prevents this.

	* src/plot3d.c (get_3ddata set_plot_with_palette) 
	src/plot2d.h src/plot2d.c (store_label): Allow palette color options
	for text in "{s}plot with labels textcolor palette ...".
	
	* src/set.c (parse_colorspec): If "tc palette" is specified with no
	further suboptions, default to "tc palette z".

	* src/plot3d.c (get_3ddata): Allow palette color options in cylindrical
	and spherical coordinate modes also.

2004-09-09  Harald Harders  <h.harders@tu-bs.de>

	* term/post.trm: Update the comment on plot-time evaluation of 
	PostScript language level support.

2004-09-09  Shigeharu Takeno  <shige@iee.niit.ac.jp>

	* docs/gnuplot.doc, term/cgm.trm, term/eepic.trm, term/emf.trm,
	term/epslatex.trm, term/post.trm: Fix misprints in gnuplot manual (#15).

2004-09-07  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (process_event) term/x11.trm: Provide a command line
	option (-ctrlq) and an X resource (gnuplor*ctrlq: true) that disable
	trapping the 'q' and '<space>' keystrokes in the plot window, instead
	trap <ctrl>q and <ctrl><space>.  This option allows the 'q' and 
	'<space>' keystrokes to be treated like all other keystrokes during 
	"pause mouse key" and other mousing operations.


2004-09-06  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* configure.in (AC_PREREQ): Bumped to 2.58, to avoid problems with
	missing AC_HEADER_STDBOOL.

2004-09-06  Daniel Sebald  <daniel.sebald@ieee.org>

	* configure.in: The --enable-image option requires general binary data
	file code. Ensure --disable-binary-data-file is not in the option list
	if only --enable-image is activated.

2004-09-06  Petr Mikulik  <mikulik@physics.muni.cz>

	* config/config.cyg config/config.mgw config/config.os2: Added #defines
	for "with image".

2004-09-03  Daniel Sebald  <daniel.sebald@ieee.org>

	* src/breaders.c src/datafile.c: Get rid of compiler warnings.

2004-09-03  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/datafile.c: Changed default value of datafile endianess after
	reset: from variable df_bin_file_endianess_reset = DF_LITTLE_ENDIAN to
	#define DF_BIN_FILE_ENDIANESS_RESET THIS_COMPILER_ENDIAN.

2004-09-03  Shigeharu Takeno  <shige@iee.niit.ac.jp>

	* demo/image.dem: Added endian=little where necessary.

2004-09-02  Ethan Merritt  <merritt@u.washington.edu>

	* demo/all.dem: Include demos for candlesticks, multiplot, and
	enhanced text mode in the all.dem script used by "make check".

2004-09-01  Ethan Merritt  <merritt@u.washington.edu>

	* term/gd.trm (PNG_set_color PNG_image) term/pdf.trm (PDF_image)
	term/post.trm (PS_image): Change call from rgb255_from_gray() to
	rgb255maxcolors_from_gray(). Fixes color mapping with 'set palette
	maxcolors'.

	* src/getcolor.c: Remove unused routine rgb255_from_gray.

	* term/gd.trm: Add WITH_IMAGE support for gif terminal also.

2004-09-01  Lars Hecking  <lhecking@nmrc.ucc.ie>

	* demo/Makefile.am.in: Add new binary demo files to Makefile.am
	target.

	src/Makefile.am: Add missing binary.h to bf_test_SOURCES.

2004-09-01  Daniel Sebald  <daniel.sebald@ieee.org>

	* NEWS: Updated.

	* configure.in: Added enable and define switches to activate new
	portions of code:
	  WITH_IMAGE (--enable-with-image) code for plotting images
	  WITH_IMAGE_VERIFY_ALL_PIXEL_LOCATIONS (--enable-image-grid-verify)
	    code for verifying every point in image grid is uniformly spaced
	  BINARY_DATA_FILE (--enable-binary-data-file) code to allow reading
	    general binary data files
	  BINARY_X11_POLYGON (--enable-binary-x11-polygon) code for X11 that
	    allows transferring polygon information as binary values rather
	    than ASCII, to save space in plot buffers

	* demo/all.dem: Added inclusion of image.dem.

	* demo/asciimat.dat demo/blutux.rgb demo/demo.edf demo/scatter2.bin
	demo/sine.bin demo/using.bin: New datafiles required by image.dem.

	* demo/image.dem: New demo to illustrate and test various new image
	and binary and matrix data file features.

	* docs/gnuplot.doc: Added documentation for image features and general
	binary file syntax.  Also, removed language indicating gnuplot matrix
	binary is restricted to `splot`, as it now can be used for images in
	`plot`.

	* src/Makefile.am: Added gplt_x11.h to gnuplot_SOURCES list and
	gnuplot_x11_SOURCES list.  Added bin_hook.c to gnuplot_SOURCES list and
	removed binary.c and binary.h from this list.

	* src/README: Added a discussion of technical details about how the
	formulas for properly orienting an image and passing that to the
	terminal driver are derived.  They can be arcane if just looking at the
	code inside plot_image_or_update_axes().  Same goes for the details
	about sending binary data to gnuplot_x11 for images.  It requires a
	simple heuristic encoding scheme to avoid a few particular characters
	from the data stream and can appear confusing at first sight.

	* src/bin_hook.c: A new, short file to include binary.c in the source
	tree if BINARY_DATA_FILE is not defined.  Otherwise, binary.c is no
	longer required.

	* src/breaders.h: An example of how to read a header in a particular
	file format and fill in the general binary structure details.  Not
	completely sure just yet how this should be integrated into gnuplot.

	* src/color.c (draw_color_smooth_box): Added an option for `plot` mode
	for use in images with a palette.

	* src/color.h: Adjusted function definition for change noted above.

	* src/command.c: Now save a new property is_cb_plot to determine if a
	color box can be part of the plot in question.

	* src/command.h: Added declaration of is_cb_plot variable.

	* src/datafile.c: Extensive additional code for interpreting general
	binary keyword syntax.  Changed df_readline() to df_readascii() and
	added a new file df_readbinary() analogous to df_readascii().  A new
	df_readline() chooses which of these two to utilize.  Code for reading
	binary and ASCII matrix format file was moved to df_readbinary().  This
	means other files in the source tree could be restructured so that the
	routine df_readline() is the only method to bring data into gnuplot.

	* src/datafile.h: Declarations for new functions as part of code noted
	above.  Also, there are a few new enumerations and, most importantly,
	the definition for the structure containing information about general
	binary records.

	* src/fit.c (fit_command): Altered df_open() argument to include the
	plot mode MODE_QUERY.

	* src/getcolor.c: Reactivated rgb255_from_gray(), required for images.

	* src/gp_types.h: Added IMAGE and RGBIMAGE to PLOT_STYLE enumeration.

	* src/gplt_x11.c: Extensive additional code for handling images in
	binary data format, polygons in binary data format, and an endianess
	check to determine if bytes need be swapped.  A simple, short encoding
	scheme is used for binary data to avoid a couple special characters in
	the data stream.

	* src/gplt_x11.h: A new header file to go along with gplt_x11.h
	containing definitions for code characters sent across pipe.  Also some
	definitions for translation characters in the binary encoding scheme.

	* src/graph3d.c (do_3dplot): Added a plot_mode of MODE_SPLOT to
	argument of draw_color_smooth_box(), as now that can also be done for
	`plot`.  Also, added cases of IMAGE and RGBIMAGE to plot style switch.

	* src/graphics.c: Added plot_image_or_update_axes(), a new image
	plotting routine.  The new routine is fairly long and arcane in spots.
	The README file contains details to clear up obscure parts.  Added the
	cases IMAGE and RGBIMAGE to the switch statement for plot style.  Also,
	there is code for making room for a color box on the plot, followed by
	a call to draw_color_smooth_box() where appropriate.

	* src/graphics.h: Added definitions PLOT_IMAGE(), SPLOT_IMAGE() and
	UPDATE_AXES_FOR_PLOT_IMAGE() to make plot_image_or_update_axes() seem
	more intuitive.

	* src/misc.c: Added 'image' and 'rgbimage' to list of plot styles in
	error message indicating valid styles.

	* src/mouse.c (builtin_toggle_log): For plots having a color box
	property, allow changing the color box to logarithmic scale.

	* src/plot2d.c: Many small alterations to case statements, etc. to
	integrate IMAGE and RGBIMAGE plot styles.  Also, added MODE_PLOT to
	df_open() argument list for binary data files.

	* src/plot3d.c: Similar to plot2d.c, many little changes made to
	incorporate IMAGE and RGBIMAGE plot styles.  Also, for general binary
	there is no longer need for df_3dmatrix(), so that call was removed.
	Added MODE_SPLOT to argument list of df_open().

	* src/save.c (save_data_func_style): Write `image` or `rgbimage` to
	file if appropriate plot style.

	* src/set.c (set_command/set_palette_file): Added call to routine
	setting defaults for binary data files if `binary` is specified as
	part of `set` command. / Added MODE_QUERY to list of arguments for
	df_open().

	* src/show.c (show_datafile): Now show information about binary data
	file settings and details about binary variable sizes in bytes for the
	compiler under which gnuplot was built.

	* src/tables.c (show_style_tbl): Added `image` and `rgbimage` to table.

	* src/term_api.h (TERMENTRY): Added image() prototype function to
	TERMENTRY structure as well as an enumeration for image type as an
	argument to image() routine.

	* src/unset.c (unset_command/reset_command): Added call to routine that
	clears the binary data file record information.

	* src/util3d.c: Added a routine map3d_xy_double() to retain more
	accurate coordinates necessary for checking uniformity of the image
	grid via hyperplane concepts.  It is repetition of existing code,
	but there is a note and define switch for code-reuse.

	* src/util3d.h: Added declaration for map3d_xy_double().

	* term/README: Added note about how to properly use image() terminal
	function.

	* term/aquaterm.trm: Per Persson added an implementation of the image()
	terminal function, AQUA_image().

	* term/dumb.trm: Ethan Merritt added a space filler for the image()
	terminal function location of TERM_TABLE.

	* term/epslatex.term: Added PS_image() to structure for image() in
	TERM_TABLE.  PS_image() is in post.trm.

	* term/gd.trm: Ethan Merritt added a routine PNG_image() for the
	TERM_TABLE entry of image().  Also, a supporting routine PNG_set_color
	was created.

	* term/pdf.trm: Ethan Merritt added a routine PDF_image() and entry
	into the TERM_TABLE for image support for PDF files.

	* term/post.trm: Added a routine PS_image() and appropriate entry in
	the TERM_TABLE for image support in PostScript files.  There is also a
	supporting routine PS_encode85() for encoding binary image data in
	ASCII85 data format.

	* term/pslatex.trm: Added PSLATEX_image() to structure for image() in
	TERM_TABLE.  It uses a simple call to PS_image(), which is in post.trm.

	* term/svg.trm: Added space filler in TERM_TABLE for image() function.

	* term/x11.trm: Added X11_image() function and entry in TERM_TABLE.
	The new image routine contains code for a simple, heuristic encoding
	scheme to prevent a couple specific bytes from being in the image data
	stream.  Similarly, X11_filled_polygon() and X11_set_color() were
	altered to use the same scheme to reduce the amount of characters
	inside the plot buffer.

2004-08-27  Per Persson <persquare@mac.com>

	* src/term.c (init_terminal): Make aqua the default terminal on
	Mac OS X if AquaTerm is installed.

2004-08-27  Ethan Merritt  <merritt@u.washington.edu>

	* term/gd.trm (PNG_vector): More specific test for libgd support of
	antialiasing.  Versions 2.0.0 -> 2.0.11 were not correctly handled by
	the previous test.

2004-08-25  Ethan Merritt  <merritt@u.washington.edu>

	* src/plot.c (main): Call term->options() on entry if the default
	terminal type is png, jpeg, or tgif.  Without this, setting GNUTERM
	to this driver type causes a segfault due to incomplete initialization
	of the driver data structures.  I believe this call to term->options()
	would be OK for all other drivers as well, but to be on the safe side
	I added it only for the drivers I know will segfault without it.

	* term/gd.trm: New option to generate truecolor png images.
	    set term png .. {{no}truecolor} ..

	* term/gd.trm (PNG_vector): Use anti-aliasing for vectors if possible.
	This does not affect palette-based PNG images, so far as I can tell,
	but does work for both JPEG and TrueColor PNG images.

2004-08-25  Per Persson <persquare@mac.com>

	* term/aquaterm.trm (AQUA_options): make options order-independent;
	replace isstring+quote_str with try_to_get_string();
	allow "font" as a synomym for "fname".

2004-08-23  Ethan Merritt  <merritt@u.washington.edu>

	* term/xlib.trm (Xlib_text): Leave output file open so that it is
	possible to plot multiple frames without another 'set term xlib'.

	* svg.trm (SVG_options): allow "font" as a synonym for "fname";
	replace isstring+quote_str with try_to_get_string();
	new option "linewidth <n>".

	* pdf.trm (PDF_options): make options order-independent;
	replace isstring+quote_str with try_to_get_string();
	allow "font" as a synomym for "fname";
	new option "linewidth <n>".

	* post.trm (PS_options): allow "font" as a synonym for "fname"

	* fig.trm (FIG_options): allow "linewidth" as a synonym for "thickness".

2004-08-23  Shigeharu Takeno  <shige@iee.niit.ac.jp>

	* docs/gnuplot.doc: Fix misprints in gnuplot manual (#14).

2004-08-20  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c (set_termoptions):  Only call term->options for
	terminals that actually support the option in question.

	* src/term.c (write_multiline) term/driver.h: Remove unused 
	function set_font_null; instead mark lack of font support by 
	initializing this TERM_TABLE entry to NULL.  Fixes segfault
	if font is checked before terminal is initialized, and allows
	non-destructive test of font support.

2004-08-20  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c (set_termoptions):  Quietly ignore the command if there
	is no current terminal.

2004-08-19  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c (set_termoptions):  Fill in basic implementation of this
	function that allows changing one characteristic of the current 
	terminal. So far the only allowed changes are the default font and
	{no}enhanced text mode.

	* demo/enhancedtext.dem:  Use 'set termoption enhanced' (new command)
	to force enhanced text mode regardless of current terminal type.

	* docs/gnuplot.doc:  Document 'set termoption <foo>'.

	* NEWS:  Update NEWS file to cover post-4.0 development work.

2004-08-18  Volker Dobler  <v.dobler@web.de>

	* src/term.c (term_end_plot term_start_multiplot term_end_multiplot):
	Implement auto-layout of multiplots with specified number of rows
	and columns.

	* docs/gnuplot.doc demo/layout.dem:  Document and illustrate use 
	of 'set multiplot layout'.

2004-08-18  Ethan Merritt  <merritt@u.washington.edu>

	* term/svg.trm: More consistent handling of default background and font.

2004-08-17  Ethan Merritt  <merritt@u.washington.edu>

	* src/eval.c (real imag magnitude angle):  Move error message handling
	into default case of switch statements (prevents compiler warnings).

	* src/plot2d.c (eval_plots) src/graphics.c (init_histogram):
	Replace instance of isstring + quote_str with try_to_get_string().
	Make histogram_title a dynamically allocated string rather than a fixed
	length char constant. 

2004-08-15  Ethan Merritt  <merritt@u.washington.edu>

	* demo/histograms.dem: Revise bmargin settings to work with the revised
	bmargin handling in graphics.c (2004-07-25).

	* src/plot2d.c (eval_plots): Fixed bug in "newhistogram 'title' ..."
	that caused the title to be ignored if there were no other options
	specified.

2004-08-13  Shigeharu Takeno  <shige@iee.niit.ac.jp>

	* src/term.c (enhanced_recursion): Pass unescaped backslash character
	through to PostScript output in enhanced text mode. This is necessary
	for Shift-JIS character encoding to work in enhanced mode (the non-
	enhanced mode already does this). Bug report #998479.

2004-08-13  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc:  Re-word the filledcurves section according to
	suggestions from Petr Mikulik.

	* term/post.trm:  Rename new option once again: set term post {level1}
	(naming history: nolevel2 -> ai -> level1). Audit code to confirm that
	in fact it excutes only commands required by PostScript Level 1.

	* src/save.c (save_tics) src/show.c (show_tics): Save tic level for 
	each explicit user-added tic. Fixes bug #1008869.

2004-08-12  Ethan Merritt  <merritt@u.washington.edu>

	* term/post.trm: Rename 'nolevel2' option to 'ai', since its primary
	use may be to generate output compatible with Adobe Illustrator.

2004-08-11  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (exec_cmd): Set line properties to CapRound, JoinRound
	while drawing plot symbols. This works around a very odd bug that
	causes the symbols to be drawn incorrectly for some X-server settings.
	Also modify plot symbol code so that the symbols are always drawn with
	a 1:1 aspect ratio (crosses always fit in a square) rather than 
	tracking the aspect ratio of the current plot window.

2004-08-10  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c (parse_colorspec): Allow people to set the text color
	to background (tc lt -2) if they really want to.

2004-08-09  Ethan Merritt  <merritt@u.washington.edu>

	* src/command.c: Remove unused prototype.

	* src/getcolor.c: Conditionally remove unused prototype during 
	compilation of gnuplot_x11.

	* src/plot2d.c (eval_plots) src/plot3d.c (eval_3dplots)
	src/set.c (set_tic_prop): Continue replacement of isstring +
	m_quote_capture with try_to_get_string().

	* src/command.c (history_command): Code cleanup; convert to use
	try_to_get_string(). Code is still full of little memory leaks.

	* term/post.trm: Fix '%' characters in output format.

2004-08-08  Ethan Merritt  <merritt@u.washington.edu>

	* src/util.c src/util.h: New routine try_to_get_string() that combines 
	isstring() and m_quote_capture(). The intent is to switch call sites
	over to using this new routine, and then extend it to handle string
	variables as well as quoted inline string constants.

	* src/contour.h: Revised declaration of contour_format[].

	* src/set.c src/command.c: Begin wholesale replacement of isstring()
	and m_quote_capture/quote_string with new routine try_to_get_string().

2004-08-07  Ethan Merritt  <merritt@u.washington.edu>

	* src/set.c (set_print set_output):  Do not chop whitespace from the
	front of input string; it causes a segfault when the string is freed.
	If we really need to strip whitespace from filenames, it should be done
	in a routine shared by all callers.

2004-08-06  Ethan Merritt  <merritt@u.washington.edu>

	* term/graphics.c (place_arrows): Restore default text color after
	drawing all the arrows. Fixes bug #1004765.

2004-08-02  Ethan Merritt  <merritt@u.washington.edu>

	* term/gd.trm src/term.h configure.in src/show.c (show_version):
	GIF support is back in libgd as of version 2.0.28 (July 2004).
	At last we can use the same driver for png, gif, and jpeg.

	* term/gif.trm term/png.trm:  Remove these old drivers.

	* src/makefile.all docs/Makefile.in: And remove them as make targets.

	* src/command.h src/command.c (load_command): Remove macro that was
	used in only one place; clean up code order as prep for applying
	string variable patches.

2004-08-01  Ethan Merritt  <merritt@u.washington.edu>
            Harald Harders  <h.harders@tu-bs.de>

	* term/post.trm: Introduce a boolean value PSLevel2 into the PostScript
	prolog, and use it to determine whether pattern-fill is defined using
	PostScript Level 2 primitives or via a Level 1 solid fill. Introduce a
	corresponding option 'set term post ... {no}level2'.  Setting level2
	to false either via 'set term' or by editing the output PostScript file
	accommodates older printers and older versions of Adobe Illustrator.

2004-07-31  Harald Harders  <h.harders@tu-bs.de>

	* term/post.trm (PS_common_init PS_put_text ENHPS_put_text):
	Check for black text only option in the PostScript code itself, 
	rather than at the time the plot is generated. This allows you to
	change your mind later by editing one line in the PostScript file.

2004-07-30  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/show.c (show_key): Fix memory leak by making the variable in
	question a local to the switch case that uses it.
	(show_styles): Remove const-ness modifying cast.

	* src/save.c (save_data_func_style): Marked pointer argument
	'which' as const.

	* src/save.h (save_data_func_style): Prototype updated
	accordingly.

2004-07-29  Ethan Merritt  <merritt@u.washington.edu>

	* docs/gnuplot.doc: Fix the alphabetical order of plot style
	doc sections.

2004-07-29  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/util.c (PRINT_SPACES_UNDER_PROMPT): Protect against
	NULL prompt.

2004-07-27  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	Bugfix: caret position of error messages in multiplot modes was
	wrong.
	
	* src/util.c (current_prompt): New variable holding the currently
	used prompt string.
	(PRINT_SPACES_UNDER_PROMPT): Use current_prompt instead of global
	PROMPT macro.  Use a pointer loop instead of a counter.
	(PRINT_SPACES_UNDER_PROMPT, PRINT_SPACES_UPTO_TOKEN): Enclosed
	macro body in do .. while(0).
	(os_error, int_error, int_warn): Use current_prompt instead of
	global macro PROMPT.

	* src/util.h (current_prompt): Declare.

	* src/command.h (PROMPT): Moved this global macro into command.c.

	* src/command.c (PROMPT): Moved macro to here.
	(read_line) [VMS]: Update new global variable current_prompt.
	(read_line) [!VMS]: Likewise.

2004-07-25  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	Code style changes: get rid of register keywords. Don't put
	parens around simple variables or term->element names.
	
	* src/graphics.c (boundary): If bmargin was set by user, key below
	should not modify ybot.  Reindented.
	
	(key_cols): Made local to boundary(), the only function using it.

2004-07-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/parse.c (cleanup_udvlist): Fix memory leak; if udv structure
	is freed, free its dynamically allocated name also.

	* src/command.c (print_set_output): Fix memory leak; free old 
	filename before setting a new one.

	* src/plot3d.c: Remove unnecessary #include "plot2d.h".

2004-07-22  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/util.h (os_error, int_error, int_warn, graph_error):
	Reverted change to prototypes for non-ANSI case back from (void)
	to ().

	* src/fit.c (Dblfn): Likewise.

2004-07-21  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (plot_bars plot_betweencurves): If the current
	terminal does not support filled_polygons, then fall back to
	yerrorbars plot style as per the documentation.

2004-07-21  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/post.trm (PS_make_header): Moved prototype into PM3D-only
	section.

2004-07-21  Lars Hecking  <lhecking@nmrc.ucc.ie>

	* demo/Makefile.am.in: Add labelplot.pdb and nearmap.csv to
	Makefile.am target.

2004-07-19  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (do_plot): Write the key titles using 
	write_multiline() rather than calling term->put_text() directly.

	* src/set.c (set_key): Fix order-dependence of 'set key' command.

2004-07-18  Ethan Merritt  <merritt@u.washington.edu>

	* term/pdf.trm: Update "Creator: " field to report version 4.1

	* term/post.trm: Petr's optimized format for solid pm3d quadrangles
	can be generated even outside the pm3d code, so the \h macro it uses
	must be defined in the header regardless of whether pm3d is in use.

2004-07-17  Ethan Merritt  <merritt@u.washington.edu>

	* term/post.trm (PS_filled_polygon): Remove extraneous gsave
	introduced by previous patch, which fixes the observed slowdown.

2004-07-16  Ethan Merritt  <merritt@u.washington.edu>

	* term/post.trm (PS_filled_polygon): The polygon fill code was
	mis-nesting gsave/grestore pairs, leading to several rather odd
	results. Fixes bug #992565 and also the loss of color information
	in pattern-filled fillcurves.

	* term/post.trm (PS_filled_polygon): Restore Petr's preferred
	compact format for the quadrangles that make up a pm3d surface,
	and add a gsave/grestore pair around the fill command. Fixes the
	moir effect observed in ghostscript/gv with antialiasing enabled.
	Downside: takes longer to render; noticeable on a slow machine.

2004-07-15  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/fig.trm (FIG_arrow): Use actual linetype variables rather
	than those in FIG_line --- those are only set by FIG_vector, which
	isn't being called by FIG_arrow.

2004-07-13  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/show.c (show_version): Removed text about backwards
	compatibility of pre-4.0 syntax from startup message.

	* term/x11.trm (transmit_gradient): Made static.  Missing
	prototype added.

	* term/post.trm: General CodeStyle cleanup.
	(ps_fontfile_def): Made static.
	(PS_make_header): made static.

	* term/gd.trm (png_smooth_color): Made static.

	* src/variable.c (fontpath_tbl): All 5 instances made static.

	* src/util.h (chr_in_str): Unused, prototype commented out.

	* src/util.c (chr_in_str): Unused, commented out.

	* src/term_api.h (change_term): Removed prototype from here.

	* src/term.c (enhanced_recursion): Made static.
	(change_term): Made static. Prototype moved here from term_api.h.
	(term_count): Unused, commented out.  Removed GP_INLINE flag.

	* src/specfun.c (merror, erf): Made static.

	* src/set.c (pm3d_last_set_palette_mode): Made static.
	(parse_histogramstyle): Made static.

	* src/save.h: Added missing #include "axis.h".

	* src/save.c: Moved #include "axis.h" to header.

	* src/plot2d.c (histogram_range_fiddling): Made static.

	* src/mouse.c (usual_special_keys): Made static.

	* src/misc.c (recursivefullname): Added missing prototypes.
	(arrow_use_properties): Made static. Moved prototype here, from
	misc.h.
	
	* src/graphics.c (place_histogram_titles, style_from_fill): Made
	static.

	* src/gplt_x11.c (process_configure_notify_event): Added missing
	prototype.
	(getMultiTabConsoleSwitchCommand): Fixed used of __PROTO() macro
	in prototype.

	* src/getcolor.h: Added missing #include "color.h".
	(color_components_from_gray, calculate_color_from_rgb_formulae,
	color_to_str, str_to_color, rgb255_from_gray): Removed prototypes.

	* src/getcolor.c: Removed #include "color.h" --- done in
	getcolor.h now.  Massive reindentation and CodeStyle cleanup.
	(color_components_from_gray, color_to_str, str_to_color): Made
	static.  Prototypes moved in here, from getcolor.h.
	(calculate_color_from_formulae): Added missing prototype.
	(rgb255_from_gray): Unused, commented out.

	* src/gadgets.h (suppressMove):  Unused, commented out.

	* src/gadgets.c (suppressMove): Unused, commented out.
	(draw_clip_line): Usage of suppressMove commented out.

	* src.fit.c(log_axis_restriction): Added missing prototype.
	
	* src/datafile.c (df_no_tic_specsm, df_column,
	df_parse_string_field): Made static.

	* src/command.c (capture_filename_and_pfopen): Added missing
	prototype.

2004-07-10  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/unset.c (unset_mtics): Renamed to unset_minitics, for
	clarity.
	(unset_month_day_tics): New function, to implement 'unset xmtics'
	and friends.
	(unset_command): Change all calls of unset_mtics to the new name.
	Implement previously missing 'unset xmtics' and friends by calling
	new function.

2004-07-09  Ethan Merritt  <merritt@u.washington.edu>

	* src/util.c (parse_esc): Limit size of octal constants to 3 chars,
	possibly with a leading 0. This prevents consuming additional 
	numerical characters from input stream.

2004-07-08  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (pr_font): Before falling back all the way to a fixed
	width font, try two common scalable fonts (helvetica, arial) as a last
	resort. Fixes bug #963211 on systems with either of these fonts.

	* src/gplt_x11.c (exec_cmd)  term/gd.trm (PNG_point): Apply current
	linewidth to point symbols.

	* src/misc.c (get_style): Add new styles 'labels' and 'histograms' to
	the error message listing possible styles.

	* configure.in: Make --enable-histograms the default.

	* demo/all.dem: Add fillbetween, datastrings, and histograms demos.

2004-07-08  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/pdf.trm (PDF_init): Call PDF_open_file() instead of
	no longer existing function PDF_open_fp().

	* demo/datastrings.dem, demo/starmap.dem: Replaced Windows-only
	font name Arial by Helvetica.

	* docs/gnuplot.doc: Remove whitespace-only lines.
	(contour): Remove outdated info on limited number of contour
	lines.

2004-07-08  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	Integrated SF patch #976546 by Stephane Barbaray, with some
	additional changes by me.
	
	* term/emf.trm: Reindented.  Ancient hacks for NeXT and <assert.h>
	purged.
	(EMF_PX2HM): Changed to 26.37.
	(EMF_HCHAR, EMF_VCHAR): Changed by factors 0.6 and 1.3,
	respectively.
	(EMF_set_font): Multiply recomputed values for h_char and v_char
	by 0.6 and 1.3, respectively.
	(EMF_setfont): Output correct font struct size with some fields
	previously missing.
	(EMF_graphics): Divide by EMF_PX2HM instead of 20.  Make reference
	device 1024x768 pixels, 270x200 mm.
	(EMF_put_text): Use ExtTextOutA instead of ExtTextOutW, include
	array of offsets
	(EMF_point): Disable special treatment of negative point types,
	i.e. dots --- why?
	(EMF_set_pointsize): Don't divide base size by 2.

2004-07-07  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/win/wtext.c (WndTextProc): Fix bug introduced during
	ANSI-fication operation.

2004-07-05  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c: Rework event-handling subroutines so that the
	intermediate window resize and redraw events are skipped if possible.
	This reduces the hysteresis when the window is resized by dragging.
	Patch by Jay Painter <jpaint@u.washington.edu>.

2004-07-05  Ethan Merritt  <merritt@u.washington.edu>

	* src/graph3d.c (place_labels3d place_arrows3d get_arrow3d): Test for
	wrap-around of negative coordinates when converted to unsigned screen
	coordinates by map3d_position. If wrap-around has occurred, then skip
	this label or arrow when drawing the 3D plot. This really should be a
	general test for out-of-bounds, but the simple test at least catches
	some potentially fatal errors that have already happened.

2004-07-04  Ethan Merritt  <merritt@u.washington.edu>

	* configure.in: --enable-histograms

	* demo/histograms.dem demo/histograms2.dem demo/immigration.dat:
	Demonstration files for 'plot with histograms'

	* docs/gnuplot.doc: Documentation for 'plot with histograms'.

	* src/datafile.c src/datafile.h src/gadgets.c src/gadgets.h
	src/gp_types.h src/graph3d.c src/graphics.c src/graphics.h
	src/plot2d.c src/save.c src/set.c src/show.c src/tables.c
	src/tables.h src/unset.c:  Integrate SourceForge patchset #606169.

	New plot style "with histograms" produces a bar chart from a sequence
	of data columns in parallel. Each element of the `plot` command must
	specify a single input data source (e.g. one column of the input file),
	possibly with associated tic values or key titles.  Three styles of
	histogram layout are currently supported. 
	     set style histogram clustered {gap <gapsize>}
	     set style histogram rowstacked
	     set style histogram columnstacked

2004-07-04  Ethan Merritt  <merritt@u.washington.edu>

	* src/color.h src/plot2d.c (get_data) src/plot3d.c (get_3ddata)
	src/save.c (save_set_all) graphics.c (bound_intersect)
	term/cgm.trm term/pdf.trm term/svg.trm:
	Add #ifdef PM3D where appropriate to allow building without PM3D.

	* src/gp_types.h: This patch starts to make term->filled_polygon
	and filledcurves independent of PM3D.

	* src/term.c (test_term): Fix broken test of filled_polygon.

	* src/graphics.c (plot_betweencurves, fill_between, bound_intersect):
	ANSIfication of function definitions.

2004-07-04  Hans-Bernhard Broeker  <broeker@accip02.physik.rwth-aachen.de>

	* src/set.c (set_arrow): Fix parsing of 'rto' vs. 'to'.  Thanks to
	Shigeharu Takeno for spotting this.

2004-07-03  Ethan Merritt  <merritt@u.washington.edu>

	* configure.in: --disable-datastrings

	* demo/ctg-y2.dat demo/datastrings.dem demo/labelplot.pdb
	demo/nearmap.csv demo/starmap.dem demo/table.dat:
	Various demos for 'plot with labels' and for reading axis tic labels
	and plot labels from a data file.

	* docs/gnuplot.doc: Documentation for 'plot with labels'
	and for reading tic and plot labels from a data file.

	* src/axis.c src/axis.h src/datafile.c src/datafile.h
	src/gadgets.c src/gadgets.h src/gp_types.h src/graph3d.c
	src/graph3d.h src/graphics.c src/graphics.h src/plot2d.c
	src/plot2d.h src/plot3d.c src/save.c src/set.c src/setshow.h
	src/show.c src/tables.c src/util.c src/util.h:
	Integrate the "datastrings" patchset (SourceForge #595850). 

	New plot style "with labels" will read a string, possibly delimited
	by quotes, from the data file and place it at the x, y, {z} 
	coordinates specified. E.g.:
	    plot 'datafile' using 1:2:3 with labels 
	    splot 'datafile' using 7:8:9:4 with labels

	New internal functions specific to the 'using' option that specify
	that string data from a datafile column is to be used for tic labels,
	or that string data from a datafile row is to be used for plot key
	titles. E.g.:
	    plot '-' using 0:2:xticlabels(1) title 2 with boxes
	    xxx  "2001"
	    Jan	  123
	    Feb	  456
	    Mar	   78
	    e
	This will plot a histogram with each an x-axis tic label under
	each box: "Jan", "Feb" etc.  The plot key will list the plot with
	title "2001".

2004-07-02  Ethan Merritt  <merritt@u.washington.edu>

	* gnuplot/src/gp_types.h gnuplot/src/graphics.c gnuplot/src/plot2d.c:
	Rename PLOT_STYLE_HAS_BOXES to PLOT_STYLE_HAS_FILL since it now 
	applies to objects other than boxes.

2004-07-02  Ethan Merritt  <merritt@u.washington.edu>

	* src/color.c src/color.h src/gadgets.h src/gp_types.h src/graphics.c 
	src/misc.c src/plot2d.c src/pm3d.c src/set.c src/tables.c src/tables.h
	src/term_api.h src/term.c:

	New capabilities for filledcurves plot style.
	(1) New options "above" and "below" to limit filled area to one side of
	the bounding line or second curve.
	(2) New ability to fill area between two curves (triggered if 3 input
	columns are given.  E.g. `plot "data" using 1:2:3 with filledcurves`
	(3) Apply current fill style to filledcurves (requires terminal support
	in term->filled_polygon).

	* demo/fillbetween.dem docs/gnuplot.doc:  documentation and demo file

	* term/cgm.trm term/gd.trm term/pdf.trm term/post.trm term/svg.trm
	term/x11.trm: Modified filled_polygon() to apply fill style passed in
	the color structure of the first vertex.

	* src/gplt_x11.c: Back-end support for applying explicit fill style
	to filled_polygon.  Beware of incompatibility with early versions.

2004-07-02  Ethan Merritt  <merritt@u.washington.edu>

	* term/post.trm: Minor cleanup of enhanced text "phantom box" macros.

2004-07-02  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* PATCHLEVEL, VERSION: Changed to version 4.1, patchlevel 0.

	* src/version.c (gnuplot_version, gnuplot_patchlevel,
	gnuplot_date): Updated by regenerating the file.

	* docs/gnuplot.doc, docs/titlepag.ms, docs/doc2texi.el: Update
	number in the title pages.

	* docs/gnuplot.texi: Regenerated.

2004-07-01  Ethan Merritt  <merritt@u.washington.edu>

	* src/fit.c: #include gp_time.h is now necessary.

2004-07-01  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* PATCHLEVEL: Raised to 2 to mark post ANSI-fication status.

	* src/version.c (gnuplot_patchlevel, gnuplot_date): Updated.

	* ChangeLog, ChangeLog.0: Cycled the ChangeLog.  Entries before
	the 4.0.0 release are now in ChangeLog.0, newer ones in ChangeLog
	(this file).

	* src/util.c (mant_exp): Modulo results can be negative.
	Aaargh!

2004-06-30  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* PATCHLEVEL: Raised to 1 in preparation of ANSI-fication.

	* src/version.c (gnuplot_patchlevel, gnuplot_date): Updated.
	(RELEASE_VERSION): Turn off.

	* INSTALL: removed pointless copy of startup banner screen.

	* docs/gnuplot.texi: Regenerated.
	
	* term/post.trm (PS_linewidth_last): New variable.
	(PS_graphics, PS_point, PS_fillbox): Initialize it.
	(PS_linetype): Call PS_FLUSH_PATH here, too.
	(PS_linewidth): Don't break the path if the new linewidth is the
	same as the cached value PS_linewidth_last.  Do a PS_FLUSH_PATH
	here, too.

	* term/debug.trm (DEBUG_arrow): Fix type of 'head' argument.

	* src/hidden3d.c (in_front): Slight change to handling of points
	falling onto edges of triangles in 2D.  Reindentations.

	* src/fit.c (log_axis_restriction): New function to output the
	actual state of the axis ranges, as optionally modified by range
	specified in the fit command line.
	(fit_command): Use it.

	* src/graphics.c (plot_bars): Reindentation.

	* src/util.c (mant_exp): Reindentation.

	* src/plot3d.c (print_3dtable): #undef OUTPUT_NUMBER earlier.

2004-06-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/mouse.c (event_reset): If 'pause mouse' terminates because
	the plot window is closed, insert an extra '\n' into the input
	stream so that the first character of the subsequent command is
	not swallowed.

2004-06-20  Ethan Merritt  <merritt@u.washington.edu>

	* src/mouse.c (event_reset), src/command.c (pause_command),
	docs/gnuplot.doc: Set MOUSE_KEY to -1 when the "pause mouse {key}"
	command is issued; if it is still -1 when checked later, then the
	calling program may assume that no mouse input was successfully
	given.

	* src/command.c (pause_command): Change the test for legality of
	"pause mouse" command from "if (term_initialised)" to "if
	(mouse_setting.on)". Really it should test whether the current
	terminal supports mousing at all, but we don't yet have such a
	flag.

	* src/gplt_x11.c (process_event): Translate keystrokes using
	XLookupString() rather than XKeycodeToKeysym(). This method
	handles characters produced using shift, alt, or other multi-key
	sequences.

	* src/graphics.c (plot_f_bars plot_c_bars), term/gd.trm
	PNG_options): Make sure that the tic size is greater than zero.

2004-06-20  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/graph3d.c (key_sample_line_pm3d key_sample_point_pm3d):
	Fixed wrong step for negative palette.

	* src/color.c (set_color) src/command.c (test_palette_subcommand)
	src/show.c (show_palette_palette): Removed useless comments.

2004-06-19  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/color.c (set_color, draw_inside_color_smooth_box_bitmap)
	src/pm3d.c (cb2gray): Invert gray in routine pm3d.c:cb2gray(cb),
	instead of color.c:set_color(gray). The latter is now just setting
	term->set_color(gray) if the terminal supports set_color() API.

	* graph3d.c (do_3dplot): Fixed set_color(z2cb( cb2gray(cntrs->z))
	to set_color(cb2gray( z2cb(cntrs->z) )).

	* gadgets.c (apply_textcolor): Take care of positive/negative
	palette for 'set label ... textcolor frac ...'.

2004-06-17  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (process_event): Send a GE_reset event back to gnuplot
	if the current plot window is closed.
	* src/mouse.c (event_reset): Terminate paused_for_mouse state whenever a
	GE_reset event is received.

2004-06-16  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (mainloop): Yet another tweak to the mouse timing code.
	This one reduces mouse-tracking hysteresis on systems that claim to have
	usleep() but in fact have much coarser timing.

2004-06-16  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/save.c: Save log cb axis (bugfix).

2004-06-14  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c: Do not start zooming during 'pause mouse'.

2004-06-12  Ethan Merritt  <merritt@u.washington.edu>

	* show.c (show_datafile): Provide missing show commands for suboptions
	"show datafile {separator|comment|missing}".

2004-06-12  Ethan Merritt  <merritt@u.washington.edu>

	* datafile.h: define DF_MISSING as a return code from df_readline().
	* datatile.c (df_readline): If a data field contains the missing data
	string, return DF_MISSING rather than DF_UNDEFINED.
	* fit.c (fit_command): Explicitly ignore DF_MISSING data.
	* plot2d.c (get_data): Explicitly test for data marked DF_MISSING 
	but treat it the same as DF_UNDEFINED.
	* plot3d.c (get_3ddata): Explicitly test for data marked DF_MISSING 
	but treat it the same as DF_UNDEFINED.
	
	These are trivial changes that do not affect the existing behavior of
	gnuplot. However, the core routines in plot2d and plot3d now have the
	information needed to treat missing data differently depending on the
	plot style if desired.

2004-06-06  Ethan Merritt  <merritt@u.washington.edu>

	* src/command.c src/command.h src/mouse.c src/gplt_x11.c
	term/x11.trm docs/gnuplot.doc docs/gnuplot.texi:  
	`pause mouse keypress` option behaves exactly as `pause mouse` except
	that the pause can be terminated by a keystroke while the plot window
	has focus. On return, the variable MOUSE_KEY contains the mouse button
	number if the pause terminated on a mouse click, otherwise it contains
	the key code of the key that was pressed. Normal ascii characters will
	return their ascii code; other keyboard keys are assigned codes from a
	table in mousecmn.h.  The command may be shortened to `pause mouse key`.

2004-06-04  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.h src/mousecmn.h src/mouse.c: Split array special_keys[] of
	of key names and key codes into special_keys[] and usual_special_keys[],
	so that "usual" keys (like BackSpace, Tab, Enter, Return, Escape, Tab,
	Delete) can have their "usual" keycodes instead of those >=1000.
	Changed lookup_key() and bind_fmt_lhs() in mouse.c to look into both
	arrays. This does not change any functionality of the current version
	of gnuplot, but will help new future features (like "pause mouse key").

2004-06-03  Ethan Merritt  <merritt@u.washington.edu>

	* term/emf.trm (EMF_linewidth): Force re-evaluation of line
	characteristics when the linewidth changes; otherwise the new width
	is ignored until some other property changes as well.

2004-06-01  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* demo/fillcrvs.dem: Add text to pause -1 prompts.

	* docs/gnuplot.doc (plot datafile using): Document restrictions of
	'using' format-strings.

	* src/datafile.c (valid_format): Check that there's at least one
	actual %lf format in the format string, and no more than 7,
	because the scanf() that uses the format supplies only 7 arguments
	to store data in.
	(plot_option_using): Change error message to reflect new status
	output of valid_format().

2004-05-28  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/getcolor.c (color_components_from_gray): Test gray value for
	being in range [0;1].

2004-05-27  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (PaletteSetColor): Test for overflow of index
	derived from color ramp calculation. Is this algorithm really correct?

2004-05-27  Petr Mikulik  <mikulik@physics.muni.cz>

	* term/post.trm (PS_make_header): Change definition of /pm3dround
	to fix color mapping with 'set palette maxcolors'.

	* src/win/wgraph.c (drawgraph): Change call from rgb255_from_gray() to
	rgb255maxcolors_from_gray(). Fixes color mapping with 'set palette
	maxcolors'.

2004-05-26  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (PaletteSetColor): Fix off-by-one error in indexing
	color ramp of gray values.

	* src/mouse.c (do_event): Allow font and terminal size information to
	be processed while in multiplot mode. See bug #955081.

2004-05-26  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/getcolor.h src/getcolor.c: New routines rgb1maxcolors_from_gray()
	and rgb255maxcolors_from_gray().

	* term/aquaterm.trm (AQUA_set_color) term/pdf.trm (PDF_set_color):
	Change call from rgb1_from_gray() to rgb1maxcolors_from_gray(). Fixes
	color mapping with 'set palette maxcolors'.

	* svg.trm (SVG_set_color): Change call from rgb255_from_gray() to
	rgb255maxcolors_from_gray(). Fixes color mapping with 'set palette
	maxcolors'.

2004-05-26  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c (event_buttonpress): Don't start zooming box if replot is
	disabled.

2004-05-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (exec_cmd): Flush polyline to X-server when it reaches
	half the maximum single request size supported on the current display.

	* term/dumb.trm term/gd.trm term/pfg.trm term/x11.trm: The enhanced text
	overprint parameter was used as an (int) in some drivers, even though it
	is declared as a TBOOLEAN.  Change it to (int) everywhere.

2004-05-24  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/pm3d.c src/term.c term/hpljii.trm: SF bug #953887 non-portable C
	code (prototypes & TBOOLEAN): input parameter for routines cannot be
	char, they must be int.

2004-05-21  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (mainloop): Add a 100 usec delay to the event flush 
	loop, so that if the other end of the pipe is jammed (gnuplot STOPPED)
	it doesn't monopolize CPU cycles. Fixes user-triggered error condition 
	reported in bug #930426.

2004-05-21  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/graphics.c (plot_boxes): Clip lower border of
	boxxyerrorbars, too.
	(do_plot): Regrouped master switch over plot types.  Draw box
	first in BOXERROR mode, to keep the lower part of the errorbar
	visible.

	* src/util.c (mant_exp): Extend technique for rounding exponents
	depending on the printf format precison of the mantissa to format
	specifiers %l and %L used for log bases other than 10.  Fixes SF
	bug #851685.

2004-05-20  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/debug.trm (DEBUG_arrow): Fix type of 'head' argument
	overlooked in earlier global change.

	* src/plot2d.c (get_data): Fix mininum number of columnts for
	boxerrorbars style.  Fixed handling of 4-column boxerrorbars in
	case of "set boxwidth -2" to match the documentation.

	* src/graphics.c (plot_impulses): Fix bug in clipping of impulses
	for out-of-range points.  Was using an integer value to store a
	floating-point temporary number.

	* src/plot2d.c (print_table): Make the table terminal output two
	blank lines at the end of each curve_points structure, to allow
	selection of individual datasets via the 'index' option.

	* docs/doc2texi.el (d2t-handle-html): Handle anchor-only <a> tags
	more sensibly: output them to the texinfo file as a @c comment.
	Patch from Shigharu Takeno.
	
	* docs/gnuplot.texi: Regenerated.

2004-05-19  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c: Fix broken zoom history with a log axis.

2004-05-17  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c src/win/wpause.c: Support for "pause mouse" in Windows
	terminal.

2004-05-16  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (boundary): prevent plot from flipping upside-down
	if the title or key take up too much vertical space.

	* term/post.trm: Add explicit default case to encoding switch.

2004-05-09  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Reduce time delay in waitforinput() from 1 sec
	to 100 usec.

2004-05-09  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gnuplot.doc src/term_api.h src/term.c term/post.trm: Add support
	for CP1250 character encoding (Central and Eastern Europe encoding on
	MS-Windows).

2004-05-09  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* config/README: Clean up some of the descriptions.

2004-05-07  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Add an explicit "noenhanced" option to set term x11,
	since otherwise once you select enhanced text you cannot turn it off
	again.

2004-05-07  Franz Bakan  <fbakan@users.sourceforge.net>

	* src/os2/gclient.c: SF bug #940596. Match menu items "GnuplotPM ->
	Mouse -> Coords format -> ..." to the text actually printed.

2004-05-06  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/win/wtext.c (WndTextProc): Fix unbelievably old
	long-standing bug: dragging the scroll bar "thumb" around didn't
	work, because the method of acccessing the position was completely
	wrong.

2004-05-04  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/set.c (set_range): Fix SF bug #946900: buggy interaction of
	'set view map' with 'set yrange'.
	(set_view): Make error message string variables static and const
	to preserve some stack.

2004-05-03  Ethan Merritt  <merritt@u.washington.edu>

	* src/mouse.c, term/x11.trm:  Move handling of mouse click after
	'pause mouse' from mouse.c to x11.trm.  This removes an otherwise
	unnecessary do_string("replot") from mouse.c, and instead adds an
	explicit check for mouse button release in X11_waitforinput().

	* demo/mousevariables.dem: Add a comment after final pause command.

	* src/set.c src/unset.c: Call gp_strdup() rather than strdup() as
	otherwise the test in ./configure is pointless, and gnuplot fails
	to link on systems without strdup().

	* term/x11.trm: Redefine VMS-only macro to allow if/then/else
	constructs: GO(x) = do {} while (0)

	* src/show.c: Protect call to add_history() with a test for the
	presence of READLINE support.

2004-04-30  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gpcard.tex: Remove duplicated X11 terminal entry.

2004-04-29  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* docs/gnuplot.doc: Fix description of default format being "% g"
	instead of "%g".

2004-04-26  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gnuplot.doc: New section "Gnuplot-defined variables". Reference
	function defined(x) from section "User-defined variables".

2004-04-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c: Correct the placement of rotated text to account
	for the difference in x and y coordinate scaling. This greatly
	improves the rendering of rotated text in enhanced text mode.

2004-04-22  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/axis.c (set_cbminmax): Don't bail out if cbrange is empty.
	Let the caller handle it by auto-extending the range, as usual.

	* src/command.c (read_line): Fix bug where growing the line buffer
	interfered with handling of backslash-newline continuations.

2004-04-21  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* demo/Makefile.am.in (check-noninteractive, check-interactive):
	keep the previous $PATH at the end of the one set for running the
	newly built, not yet installed gnuplot.  Needed so Cygwin binaries
	can find Cygwin1.dll, even if it's not installed in the Windows
	DLL path.

2004-04-20  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* docs/gnuplot.texi: Regenerated.

	* docs/gnuplot.doc: Fixed missing leading blanks broken during URL
	updates.

	* docs/Makefile.in ($(srcdir)/gnuplot.texi): Fix missing blank in
	file copying rule.

2004-04-17  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Clear all I/O locks when X11_reset is called.
	This is a more generic fix for the problem addressed by the patch
	of 2004-04-13, and covers cases such as a remote X-server failing
	to respond. Even without this patch the connection will eventually
	timeout, but with the patch you can ctrl-C out rather than waiting.

