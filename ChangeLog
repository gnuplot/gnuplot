2004-07-15  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/fig.trm (FIG_arrow): Use actual linetype variables rather
	than those in FIG_line --- those are only set by FIG_vector, which
	isn't being called by FIG_arrow.

2004-07-10  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/unset.c (unset_mtics): Renamed to unset_minitics, for
	clarity.
	(unset_month_day_tics): New function, to implement 'unset xmtics'
	and friends.
	(unset_command): Change all calls of unset_mtics to the new name.
	Implement previously missing 'unset xmtics' and friends by calling
	new function.

2004-07-09  Ethan Merritt  <merritt@u.washington.edu>

	* src/util.c (parse_esc): Limit size of octal constants to 3 chars,
	possibly with a leading 0. This prevents consuming additional 
	numerical characters from input stream.

2004-07-08  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/pdf.trm (PDF_init): Call PDF_open_file() instead of
	no longer existing function PDF_open_fp().

	* docs/gnuplot.doc: (contour): Remove outdated info on limited
	number of contour lines.

2004-07-08  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	Integrated SF patch #976546 by Stephane Barbaray, with some
	additional changes by me.
	
	* term/emf.trm: Reindented.  Ancient hacks for NeXT and <assert.h>
	purged.
	(EMF_PX2HM): Changed to 26.37.
	(EMF_HCHAR, EMF_VCHAR): Changed by factors 0.6 and 1.3,
	respectively.
	(EMF_set_font): Multiply recomputed values for h_char and v_char
	by 0.6 and 1.3, respectively.
	(EMF_setfont): Output correct font struct size with some fields
	previously missing.
	(EMF_graphics): Divide by EMF_PX2HM instead of 20.  Make reference
	device 1024x768 pixels, 270x200 mm.
	(EMF_put_text): Use ExtTextOutA instead of ExtTextOutW, include
	array of offsets
	(EMF_point): Disable special treatment of negative point types,
	i.e. dots --- why?
	(EMF_set_pointsize): Don't divide base size by 2.

2004-07-07  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/win/wtext.c (WndTextProc): Fix bug introduced during
	ANSI-fication operation.

2004-07-01  Ethan Merritt  <merritt@u.washington.edu>

	* src/fit.c: #include gp_time.h is now necessary.

2004-07-01  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* PATCHLEVEL: Raised to 2 to mark post ANSI-fication status.

	* src/version.c (gnuplot_patchlevel, gnuplot_date): Updated.

	* ChangeLog, ChangeLog.0: Cycled the ChangeLog.  Entries before
	the 4.0.0 release are now in ChangeLog.0, newer ones in ChangeLog
	(this file).

	* src/util.c (mant_exp): Modulo results can be negative.
	Aaargh!

2004-06-30  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* PATCHLEVEL: Raised to 1 in preparation of ANSI-fication.

	* src/version.c (gnuplot_patchlevel, gnuplot_date): Updated.
	(RELEASE_VERSION): Turn off.

	* INSTALL: removed pointless copy of startup banner screen.

	* docs/gnuplot.texi: Regenerated.
	
	* term/post.trm (PS_linewidth_last): New variable.
	(PS_graphics, PS_point, PS_fillbox): Initialize it.
	(PS_linetype): Call PS_FLUSH_PATH here, too.
	(PS_linewidth): Don't break the path if the new linewidth is the
	same as the cached value PS_linewidth_last.  Do a PS_FLUSH_PATH
	here, too.

	* term/debug.trm (DEBUG_arrow): Fix type of 'head' argument.

	* src/hidden3d.c (in_front): Slight change to handling of points
	falling onto edges of triangles in 2D.  Reindentations.

	* src/fit.c (log_axis_restriction): New function to output the
	actual state of the axis ranges, as optionally modified by range
	specified in the fit command line.
	(fit_command): Use it.

	* src/graphics.c (plot_bars): Reindentation.

	* src/util.c (mant_exp): Reindentation.

	* src/plot3d.c (print_3dtable): #undef OUTPUT_NUMBER earlier.

2004-06-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/mouse.c (event_reset): If 'pause mouse' terminates because
	the plot window is closed, insert an extra '\n' into the input
	stream so that the first character of the subsequent command is
	not swallowed.

2004-06-20  Ethan Merritt  <merritt@u.washington.edu>

	* src/mouse.c (event_reset), src/command.c (pause_command),
	docs/gnuplot.doc: Set MOUSE_KEY to -1 when the "pause mouse {key}"
	command is issued; if it is still -1 when checked later, then the
	calling program may assume that no mouse input was successfully
	given.

	* src/command.c (pause_command): Change the test for legality of
	"pause mouse" command from "if (term_initialised)" to "if
	(mouse_setting.on)". Really it should test whether the current
	terminal supports mousing at all, but we don't yet have such a
	flag.

	* src/gplt_x11.c (process_event): Translate keystrokes using
	XLookupString() rather than XKeycodeToKeysym(). This method
	handles characters produced using shift, alt, or other multi-key
	sequences.

	* src/graphics.c (plot_f_bars plot_c_bars), term/gd.trm
	PNG_options): Make sure that the tic size is greater than zero.

2004-06-20  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/graph3d.c (key_sample_line_pm3d key_sample_point_pm3d):
	Fixed wrong step for negative palette.

	* src/color.c (set_color) src/command.c (test_palette_subcommand)
	src/show.c (show_palette_palette): Removed useless comments.

2004-06-19  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/color.c (set_color, draw_inside_color_smooth_box_bitmap)
	src/pm3d.c (cb2gray): Invert gray in routine pm3d.c:cb2gray(cb),
	instead of color.c:set_color(gray). The latter is now just setting
	term->set_color(gray) if the terminal supports set_color() API.

	* graph3d.c (do_3dplot): Fixed set_color(z2cb( cb2gray(cntrs->z))
	to set_color(cb2gray( z2cb(cntrs->z) )).

	* gadgets.c (apply_textcolor): Take care of positive/negative
	palette for 'set label ... textcolor frac ...'.

2004-06-17  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (process_event): Send a GE_reset event back to gnuplot
	if the current plot window is closed.
	* src/mouse.c (event_reset): Terminate paused_for_mouse state whenever a
	GE_reset event is received.

2004-06-16  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (mainloop): Yet another tweak to the mouse timing code.
	This one reduces mouse-tracking hysteresis on systems that claim to have
	usleep() but in fact have much coarser timing.

2004-06-16  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/save.c: Save log cb axis (bugfix).

2004-06-14  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c: Do not start zooming during 'pause mouse'.

2004-06-12  Ethan Merritt  <merritt@u.washington.edu>

	* show.c (show_datafile): Provide missing show commands for suboptions
	"show datafile {separator|comment|missing}".

2004-06-12  Ethan Merritt  <merritt@u.washington.edu>

	* datafile.h: define DF_MISSING as a return code from df_readline().
	* datatile.c (df_readline): If a data field contains the missing data
	string, return DF_MISSING rather than DF_UNDEFINED.
	* fit.c (fit_command): Explicitly ignore DF_MISSING data.
	* plot2d.c (get_data): Explicitly test for data marked DF_MISSING 
	but treat it the same as DF_UNDEFINED.
	* plot3d.c (get_3ddata): Explicitly test for data marked DF_MISSING 
	but treat it the same as DF_UNDEFINED.
	
	These are trivial changes that do not affect the existing behavior of
	gnuplot. However, the core routines in plot2d and plot3d now have the
	information needed to treat missing data differently depending on the
	plot style if desired.

2004-06-06  Ethan Merritt  <merritt@u.washington.edu>

	* src/command.c src/command.h src/mouse.c src/gplt_x11.c
	term/x11.trm docs/gnuplot.doc docs/gnuplot.texi:  
	`pause mouse keypress` option behaves exactly as `pause mouse` except
	that the pause can be terminated by a keystroke while the plot window
	has focus. On return, the variable MOUSE_KEY contains the mouse button
	number if the pause terminated on a mouse click, otherwise it contains
	the key code of the key that was pressed. Normal ascii characters will
	return their ascii code; other keyboard keys are assigned codes from a
	table in mousecmn.h.  The command may be shortened to `pause mouse key`.

2004-06-04  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.h src/mousecmn.h src/mouse.c: Split array special_keys[] of
	of key names and key codes into special_keys[] and usual_special_keys[],
	so that "usual" keys (like BackSpace, Tab, Enter, Return, Escape, Tab,
	Delete) can have their "usual" keycodes instead of those >=1000.
	Changed lookup_key() and bind_fmt_lhs() in mouse.c to look into both
	arrays. This does not change any functionality of the current version
	of gnuplot, but will help new future features (like "pause mouse key").

2004-06-03  Ethan Merritt  <merritt@u.washington.edu>

	* term/emf.trm (EMF_linewidth): Force re-evaluation of line
	characteristics when the linewidth changes; otherwise the new width
	is ignored until some other property changes as well.

2004-06-01  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* demo/fillcrvs.dem: Add text to pause -1 prompts.

	* docs/gnuplot.doc (plot datafile using): Document restrictions of
	'using' format-strings.

	* src/datafile.c (valid_format): Check that there's at least one
	actual %lf format in the format string, and no more than 7,
	because the scanf() that uses the format supplies only 7 arguments
	to store data in.
	(plot_option_using): Change error message to reflect new status
	output of valid_format().

2004-05-28  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/getcolor.c (color_components_from_gray): Test gray value for
	being in range [0;1].

2004-05-27  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (PaletteSetColor): Test for overflow of index
	derived from color ramp calculation. Is this algorithm really correct?
	
2004-05-27  Petr Mikulik  <mikulik@physics.muni.cz>

	* term/post.trm (PS_make_header): Change definition of /pm3dround
	to fix color mapping with 'set palette maxcolors'.

	* src/win/wgraph.c (drawgraph): Change call from rgb255_from_gray() to
	rgb255maxcolors_from_gray(). Fixes color mapping with 'set palette
	maxcolors'.

2004-05-26  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (PaletteSetColor): Fix off-by-one error in indexing
	color ramp of gray values.

	* src/mouse.c (do_event): Allow font and terminal size information to
	be processed while in multiplot mode. See bug #955081.

2004-05-26  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/getcolor.h src/getcolor.c: New routines rgb1maxcolors_from_gray()
	and rgb255maxcolors_from_gray().

	* term/aquaterm.trm (AQUA_set_color) term/pdf.trm (PDF_set_color):
	Change call from rgb1_from_gray() to rgb1maxcolors_from_gray(). Fixes
	color mapping with 'set palette maxcolors'.

	* svg.trm (SVG_set_color): Change call from rgb255_from_gray() to
	rgb255maxcolors_from_gray(). Fixes color mapping with 'set palette
	maxcolors'.

2004-05-26  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c (event_buttonpress): Don't start zooming box if replot is
	disabled.

2004-05-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (exec_cmd): Flush polyline to X-server when it reaches
	half the maximum single request size supported on the current display.

	* term/dumb.trm term/gd.trm term/pfg.trm term/x11.trm: The enhanced text
	overprint parameter was used as an (int) in some drivers, even though it
	is declared as a TBOOLEAN.  Change it to (int) everywhere.

2004-05-24  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/pm3d.c src/term.c term/hpljii.trm: SF bug #953887 non-portable C
	code (prototypes & TBOOLEAN): input parameter for routines cannot be
	char, they must be int.

2004-05-21  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c (mainloop): Add a 100 usec delay to the event flush 
	loop, so that if the other end of the pipe is jammed (gnuplot STOPPED)
	it doesn't monopolize CPU cycles. Fixes user-triggered error condition 
	reported in bug #930426.

2004-05-21  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/graphics.c (plot_boxes): Clip lower border of
	boxxyerrorbars, too.
	(do_plot): Regrouped master switch over plot types.  Draw box
	first in BOXERROR mode, to keep the lower part of the errorbar
	visible.

	* src/util.c (mant_exp): Extend technique for rounding exponents
	depending on the printf format precison of the mantissa to format
	specifiers %l and %L used for log bases other than 10.  Fixes SF
	bug #851685.

2004-05-20  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* term/debug.trm (DEBUG_arrow): Fix type of 'head' argument
	overlooked in earlier global change.

	* src/plot2d.c (get_data): Fix mininum number of columnts for
	boxerrorbars style.  Fixed handling of 4-column boxerrorbars in
	case of "set boxwidth -2" to match the documentation.

	* src/graphics.c (plot_impulses): Fix bug in clipping of impulses
	for out-of-range points.  Was using an integer value to store a
	floating-point temporary number.

	* src/plot2d.c (print_table): Make the table terminal output two
	blank lines at the end of each curve_points structure, to allow
	selection of individual datasets via the 'index' option.

	* docs/doc2texi.el (d2t-handle-html): Handle anchor-only <a> tags
	more sensibly: output them to the texinfo file as a @c comment.
	Patch from Shigharu Takeno.
	
	* docs/gnuplot.texi: Regenerated.

2004-05-19  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c: Fix broken zoom history with a log axis.

2004-05-17  Petr Mikulik  <mikulik@physics.muni.cz>

	* src/mouse.c src/win/wpause.c: Support for "pause mouse" in Windows
	terminal.

2004-05-16  Ethan Merritt  <merritt@u.washington.edu>

	* src/graphics.c (boundary): prevent plot from flipping upside-down
	if the title or key take up too much vertical space.

	* term/post.trm: Add explicit default case to encoding switch.

2004-05-09  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Reduce time delay in waitforinput() from 1 sec
	to 100 usec.

2004-05-09  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gnuplot.doc src/term_api.h src/term.c term/post.trm: Add support
	for CP1250 character encoding (Central and Eastern Europe encoding on
	MS-Windows).

2004-05-09  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* config/README: Clean up some of the descriptions.

2004-05-07  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Add an explicit "noenhanced" option to set term x11,
	since otherwise once you select enhanced text you cannot turn it off
	again.

2004-05-07  Franz Bakan  <fbakan@users.sourceforge.net>

	* src/os2/gclient.c: SF bug #940596. Match menu items "GnuplotPM ->
	Mouse -> Coords format -> ..." to the text actually printed.

2004-05-06  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/win/wtext.c (WndTextProc): Fix unbelievably old
	long-standing bug: dragging the scroll bar "thumb" around didn't
	work, because the method of acccessing the position was completely
	wrong.

2004-05-04  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/set.c (set_range): Fix SF bug #946900: buggy interaction of
	'set view map' with 'set yrange'.
	(set_view): Make error message string variables static and const
	to preserve some stack.

2004-05-03  Ethan Merritt  <merritt@u.washington.edu>

	* src/mouse.c, term/x11.trm:  Move handling of mouse click after
	'pause mouse' from mouse.c to x11.trm.  This removes an otherwise
	unnecessary do_string("replot") from mouse.c, and instead adds an
	explicit check for mouse button release in X11_waitforinput().

	* demo/mousevariables.dem: Add a comment after final pause command.

	* src/set.c src/unset.c: Call gp_strdup() rather than strdup() as
	otherwise the test in ./configure is pointless, and gnuplot fails
	to link on systems without strdup().

	* term/x11.trm: Redefine VMS-only macro to allow if/then/else
	constructs: GO(x) = do {} while (0)

	* src/show.c: Protect call to add_history() with a test for the
	presence of READLINE support.

2004-04-30  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gpcard.tex: Remove duplicated X11 terminal entry.

2004-04-29  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* docs/gnuplot.doc: Fix description of default format being "% g"
	instead of "%g".

2004-04-26  Petr Mikulik  <mikulik@physics.muni.cz>

	* docs/gnuplot.doc: New section "Gnuplot-defined variables". Reference
	function defined(x) from section "User-defined variables".

2004-04-24  Ethan Merritt  <merritt@u.washington.edu>

	* src/gplt_x11.c: Correct the placement of rotated text to account
	for the difference in x and y coordinate scaling. This greatly
	improves the rendering of rotated text in enhanced text mode.

2004-04-22  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* src/axis.c (set_cbminmax): Don't bail out if cbrange is empty.
	Let the caller handle it by auto-extending the range, as usual.

	* src/command.c (read_line): Fix bug where growing the line buffer
	interfered with handling of backslash-newline continuations.

2004-04-21  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* demo/Makefile.am.in (check-noninteractive, check-interactive):
	keep the previous $PATH at the end of the one set for running the
	newly built, not yet installed gnuplot.  Needed so Cygwin binaries
	can find Cygwin1.dll, even if it's not installed in the Windows
	DLL path.

2004-04-20  Hans-Bernhard Broeker  <broeker@physik.rwth-aachen.de>

	* docs/gnuplot.texi: Regenerated.

	* docs/gnuplot.doc: Fixed missing leading blanks broken during URL
	updates.

	* docs/Makefile.in ($(srcdir)/gnuplot.texi): Fix missing blank in
	file copying rule.

2004-04-17  Ethan Merritt  <merritt@u.washington.edu>

	* term/x11.trm: Clear all I/O locks when X11_reset is called.
	This is a more generic fix for the problem addressed by the patch
	of 2004-04-13, and covers cases such as a remote X-server failing
	to respond. Even without this patch the connection will eventually
	timeout, but with the patch you can ctrl-C out rather than waiting.

